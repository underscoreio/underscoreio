<!DOCTYPE html>
<html lang="en" id="/blog/posts/2017/03/07/refined-data-config-database" class="">
  
  
  <head>
    <title>Refining your data from configuration to database - Underscore</title>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link type="text/css" rel="stylesheet" href="/assets/screen-9132d4f189ef656eb3d1e8defedf7c83e32e9240d9a3af3d804d36f850e43dd5.css">
    <link type="text/css" rel="stylesheet" href="/assets/print-dd04f6182ddcf193d2ac9f59bdbdbb366e01738f8a32086ffb82c7be2f9e1eb8.css" media="print">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@underscoreio">
    
      <meta name="twitter:title" content="Refining your data from configuration to database">
    
    
      <meta name="twitter:description" content="One of the promises of strongly typed languages is that the compiler will catch your errors instead of throwing unexpected exceptions at runtime. In this post we will cover all stages of an application from model, user input, configuration, and database, seeing how far one can take this approach without hitting a ‘diminishing returns’ wall.

">
    
    
      <meta name="twitter:image" content="http://underscore.io/images/twitter-card-icon.png">
    

    <link rel="shortcut icon" href="/images/favicon-64.png">
    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
    <link rel="alternate" type="application/rss+xml" title="RSS" href="/blog/feed.xml">

    <link rel="canonical" href="http://underscore.io/blog/posts/2017/03/07/refined-data-config-database.html">

    <script type="text/javascript" src="/assets/site-5ab8e41df06f32ccfbf4c40fdf2d7fc81c360b991aa5c153ed01fd0714c019d4.js"></script>
  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/"><span class="icon-uio-underscore "></span></a>
    </div>

    <div class="navbar-collapse">
      <ul class="nav navbar-nav navbar-right visible-md visible-lg">
        <li class="divider"></li>
        <li class="social"><a href="http://twitter.com/underscoreio"><span class="icon-uio-twitter "></span><span class="sr-only">Twitter</span></a></li>
        <li class="social"><a href="/contact"><span class="icon-uio-envelope "></span><span class="sr-only">Email</span></a></li>
      </ul>

      <ul class="nav navbar-nav navbar-right">
        <li class="visible-xs "><a href="/">Home</a></li>
        <li class=""><a href="/development">Development</a></li>
        <li class=""><a href="/consulting">Consulting</a></li>
        <li class=""><a href="/training">Training</a></li>
        <!-- li class=""><a href="/books">Books</a></li -->
        <li class=""><a href="/company">Company</a></li>
      </ul>
    </div>
  </div>
</nav>


<div class="hero">
  <div class="overlay-gem-left-white hero-overlay-soft"></div>
  <div class="overlay-gem-right-white hero-overlay-soft"></div>
  <div class="overlay-arrow-white-inverse"></div>

  <nav class="navbar navbar-inverse" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/"><span class="icon-uio-underscore "></span></a>
    </div>

    <div class="navbar-collapse">
      <ul class="nav navbar-nav navbar-right visible-md visible-lg">
        <li class="divider"></li>
        <li class="social"><a href="http://twitter.com/underscoreio"><span class="icon-uio-twitter "></span><span class="sr-only">Twitter</span></a></li>
        <li class="social"><a href="/contact"><span class="icon-uio-envelope "></span><span class="sr-only">Email</span></a></li>
      </ul>

      <ul class="nav navbar-nav navbar-right">
        <li class="visible-xs "><a href="/">Home</a></li>
        <li class=""><a href="/development">Development</a></li>
        <li class=""><a href="/consulting">Consulting</a></li>
        <li class=""><a href="/training">Training</a></li>
        <!-- li class=""><a href="/books">Books</a></li -->
        <li class=""><a href="/company">Company</a></li>
      </ul>
    </div>
  </div>
</nav>


  <header class="hero-text">
    <div class="container">
      
        <h1>
          <a class="back-link" href="/blog">
            Blog
            <span class="icon-uio-back "></span>
          </a>
        </h1>
      

      
    </div>
  </header>
</div>


<section class="container">
  <div class="row">
    <div class="col-md-8">
      <section class="blog-post" data-post-url="/blog/posts/2017/03/07/refined-data-config-database.html">
        <h2 class="blog-post-title">Refining your data from configuration to database</h2>

        <dl class="blog-post-meta">
  <dt class="blog-post-date">Posted</dt>
  <dd class="blog-post-date">
    <span class="day">07</span>
    <span class="month">Mar</span>
    <span class="year">2017</span>
  </dd>
  <dt class="blog-post-author">by</dt>
  <dd class="blog-post-author">
    Pere Villega
  </dd>
  
</dl>


        <article class="blog-post-content">
          <p>One of the promises of strongly typed languages is that the compiler will catch your errors instead of throwing unexpected exceptions at runtime. In this post we will cover all stages of an application from model, user input, configuration, and database, seeing how far one can take this approach without hitting a ‘diminishing returns’ wall.</p>

<!-- break -->

<h1 id="the-prelude">The prelude</h1>

<p>The road to true type safety is not hard, but requires some commitment. At the initial stage you have chosen a typed language that enforces some restrictions at compile time, so you know that if you try the following:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">add</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">b</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

<span class="k">def</span> <span class="nf">getHttpQueryParam</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="o">???</span>

<span class="nf">add</span><span class="o">(</span><span class="n">getHttpQueryParam</span><span class="o">,</span> <span class="mi">2</span><span class="o">)</span> 

<span class="c1">// Error:(10, 8) type mismatch;</span>
      <span class="n">found</span>   <span class="k">:</span> <span class="kt">String</span>
      <span class="n">required</span><span class="k">:</span> <span class="kt">Int</span>
      <span class="nf">add</span><span class="o">(</span><span class="n">queryParam</span><span class="o">,</span> <span class="mi">2</span><span class="o">)</span>
          <span class="o">^</span>
</code></pre></div></div>

<p>That is, the code above is warning you that when you obtained a query parameter from a request you got a String, which you are trying to use as an Integer, which won’t work. You are forced to convert that String to an Integer first, considering the cases where the String is not a valid Integer, and managing them.</p>

<p>This is nice and saves a lot of hassle, but probably we all have seen a class like follows:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">Person</span><span class="o">(</span><span class="n">firstName</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">lastName</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>
</code></pre></div></div>

<p>which seems good enough until you start seeing errors due to some method mistakenly passing the <code class="language-plaintext highlighter-rouge">lastName</code> in the first position, where the <code class="language-plaintext highlighter-rouge">firstName</code> should go.</p>

<p>There is a standard pattern to solve this issue, using <a href="http://docs.scala-lang.org/overviews/core/value-classes.html">value classes</a> to ensure the proper values go to the right position:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">FirstName</span><span class="o">(</span><span class="k">val</span> <span class="nv">firstName</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">AnyVal</span>
<span class="k">class</span> <span class="nc">LastName</span><span class="o">(</span><span class="k">val</span> <span class="nv">lastName</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">AnyVal</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">Person</span><span class="o">(</span><span class="n">firstName</span><span class="k">:</span> <span class="kt">FirstName</span><span class="o">,</span> <span class="n">lastName</span><span class="k">:</span> <span class="kt">LastName</span><span class="o">)</span>
 
<span class="k">val</span> <span class="nv">player</span> <span class="k">=</span> <span class="nc">Person</span><span class="o">(</span><span class="k">new</span> <span class="nc">FirstName</span><span class="o">(</span><span class="s">"Light"</span><span class="o">),</span> <span class="k">new</span> <span class="nc">LastName</span><span class="o">(</span><span class="s">"Yagami"</span><span class="o">))</span>
</code></pre></div></div>

<p>This is a common pattern, and most likely something you use daily. Slightly more effort declaring a few new types ensures some silly mistakes won’t happen. And thanks to the <code class="language-plaintext highlighter-rouge">AnyVal</code> magic there is no runtime penalty over using the more generic representation.</p>

<p>But can we do better?</p>

<h1 id="a-case-refined-configuration">A case: Refined configuration</h1>

<p>Let’s consider an area with frequent mistakes: application configuration. In Scala is common to use the <a href="https://github.com/typesafehub/config">Typesafe Config</a> structure where your configuration is stored in a file, <code class="language-plaintext highlighter-rouge">application.conf</code>. As such it is not part of the code and you can’t apply the previous pattern to it.</p>

<p>Let’s assume you have the following in your <code class="language-plaintext highlighter-rouge">application.conf</code> file:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>server.interface="0.0.0.0"

server.port=8080
server.port=${?http.port}
</code></pre></div></div>

<p>You could load it manually, which is cumbersome and requires you to convert each type to the proper value. Or you can just use <a href="https://github.com/melrief/pureconfig">PureConfig</a> to take care of that for you, giving you some extra type safety in the process:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">pureconfig.loadConfig</span>
<span class="k">import</span> <span class="nn">scala.util.</span><span class="o">{</span> <span class="nc">Failure</span><span class="o">,</span> <span class="nc">Success</span> <span class="o">}</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">Server</span><span class="o">(</span><span class="n">interface</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">port</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Settings</span><span class="o">(</span><span class="n">server</span><span class="k">:</span> <span class="kt">Server</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">config</span><span class="k">:</span> <span class="kt">Settings</span> <span class="o">=</span> <span class="n">loadConfig</span><span class="o">[</span><span class="kt">Settings</span><span class="o">]</span> <span class="k">match</span> <span class="o">{</span>
  <span class="k">case</span> <span class="nc">Success</span><span class="o">(</span><span class="n">conf</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">conf</span>
  <span class="k">case</span> <span class="nc">Failure</span><span class="o">(</span><span class="n">ex</span><span class="o">)</span> <span class="k">=&gt;</span>
    <span class="nf">println</span><span class="o">(</span><span class="n">s</span><span class="s">"Error loading configuration: $ex.\nProgram will now exit."</span><span class="o">)</span>
    <span class="k">throw</span> <span class="n">ex</span>
<span class="o">}</span>
</code></pre></div></div>

<p>This snippet will automatically load your <code class="language-plaintext highlighter-rouge">application.conf</code> and map it to a set of nested case classes, <code class="language-plaintext highlighter-rouge">Settings</code> and <code class="language-plaintext highlighter-rouge">Server</code>. It will also fail if the configuration doesn’t match what you expect. For example a mistake defining the case classes:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>case class Server(interface: Int, port: Int)
case class Settings(server: Server)
</code></pre></div></div>

<p>will cause an exception when loading the configuration:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Error loading configuration: java.lang.NumberFormatException: For input string: "0.0.0.0".
Program will now exit.
java.lang.NumberFormatException: For input string: "0.0.0.0"
</code></pre></div></div>

<p>But some changes, although wrong, will go unnoticed. Let’s say you have a typo in the configuration and define your <code class="language-plaintext highlighter-rouge">application.conf</code> file:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>server.interface="0.0.0.0"

server.port=808
server.port=${?http.port}
</code></pre></div></div>

<p>Now, port <code class="language-plaintext highlighter-rouge">808</code> is a reserved port, as are all ports below 1024, so you would need to be root to get hold of it. But if you test the configuration file, even with <a href="https://github.com/melrief/pureconfig">PureConfig</a>, it will succeed as it is a valid value for an Integer.</p>

<p>Can we do better?</p>

<p>Yes, we can. Enter <a href="https://github.com/fthomas/refined">Refined</a>, a <a href="http://typelevel.org/projects/">Typelevel project</a>, a library for refining types with type-level predicates which constrain the set of values described by the refined type. We will see shortly what does this mean in practice.</p>

<p>Luckily <a href="https://github.com/melrief/pureconfig">PureConfig</a> has a module to <a href="https://github.com/melrief/pureconfig#integrating-with-other-libraries">integrate with Refined</a>, and a very good explanation on how to use both together by <a href="https://blog.vlovgr.se/posts/2016-12-24-refined-configuration.html">Viktor Lövgren</a>.</p>

<p>In our example, this means that we can define two new refined types:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">eu.timepit.refined.W</span>
<span class="k">import</span> <span class="nn">eu.timepit.refined.api.Refined</span>
<span class="k">import</span> <span class="nn">eu.timepit.refined.collection.NonEmpty</span>
<span class="k">import</span> <span class="nn">eu.timepit.refined.numeric.Greater</span>

<span class="k">type</span> <span class="kt">NonEmptyString</span> <span class="o">=</span> <span class="nc">String</span> <span class="nc">Refined</span> <span class="nc">NonEmpty</span>
<span class="k">type</span> <span class="kt">ServerPort</span>     <span class="o">=</span> <span class="nc">Int</span> <span class="nc">Refined</span> <span class="nc">Greater</span><span class="o">[</span><span class="kt">W.`</span><span class="err">1024</span><span class="kt">`.T</span><span class="o">]</span>
</code></pre></div></div>

<p>The first type identifies a non-empty string, the second a port for a server ensuring the selected port will not be within the restricted area.</p>

<p>We then modify the way we defined our configuration tree so we take advantage of these new types:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">pureconfig.loadConfig</span>
<span class="k">import</span> <span class="nn">eu.timepit.refined.auto._</span>
<span class="k">import</span> <span class="nn">eu.timepit.refined.pureconfig._</span>
<span class="k">import</span> <span class="nn">scala.util.</span><span class="o">{</span><span class="nc">Failure</span><span class="o">,</span> <span class="nc">Success</span><span class="o">}</span>
  
<span class="k">case</span> <span class="k">class</span> <span class="nc">Server</span><span class="o">(</span><span class="n">interface</span><span class="k">:</span> <span class="kt">NonEmptyString</span><span class="o">,</span> <span class="n">port</span><span class="k">:</span> <span class="kt">ServerPort</span><span class="o">)</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Settings</span><span class="o">(</span><span class="n">server</span><span class="k">:</span> <span class="kt">Server</span><span class="o">)</span>

<span class="k">val</span> <span class="nv">config</span><span class="k">:</span> <span class="kt">Settings</span> <span class="o">=</span> <span class="n">loadConfig</span><span class="o">[</span><span class="kt">Settings</span><span class="o">]</span> <span class="k">match</span> <span class="o">{</span>
  <span class="k">case</span> <span class="nc">Success</span><span class="o">(</span><span class="n">conf</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">conf</span>
  <span class="k">case</span> <span class="nc">Failure</span><span class="o">(</span><span class="n">ex</span><span class="o">)</span> <span class="k">=&gt;</span>
    <span class="nf">println</span><span class="o">(</span><span class="n">s</span><span class="s">"Error loading configuration: $ex.\nProgram will now exit."</span><span class="o">)</span>
    <span class="k">throw</span> <span class="n">ex</span>
<span class="o">}</span>  
</code></pre></div></div>

<p>Using the incorrect configuration now will return the following error:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Error loading configuration: eu.timepit.refined.pureconfig.error.PredicateFailedException: Predicate failed: (808 &gt; 1024)..
Program will now exit.
eu.timepit.refined.pureconfig.error.PredicateFailedException: Predicate failed: (808 &gt; 1024).
</code></pre></div></div>

<p>and we can use it to search for the culprit (value <code class="language-plaintext highlighter-rouge">808</code>) and understand what went wrong.
Obviously this gets better when you run unit tests on your code that verify the static configuration is valid. You do run them, don’t you? Just in case, an example:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">com.typesafe.config.ConfigFactory</span>
<span class="k">import</span> <span class="nn">pureconfig.loadConfig</span>
<span class="k">import</span> <span class="nn">eu.timepit.refined.pureconfig._</span>
<span class="k">import</span> <span class="nn">org.scalatest.</span><span class="o">{</span><span class="nc">FreeSpec</span><span class="o">,</span> <span class="nc">Matchers</span><span class="o">}</span>

<span class="k">import</span> <span class="nn">scala.util.</span><span class="o">{</span><span class="nc">Failure</span><span class="o">,</span> <span class="nc">Success</span><span class="o">}</span>

<span class="k">class</span> <span class="nc">ConfigSpec</span> <span class="k">extends</span> <span class="nc">FreeSpec</span> <span class="k">with</span> <span class="nc">Matchers</span> <span class="o">{</span>

  <span class="s">"Hardcoded configuration"</span> <span class="o">-</span> <span class="o">{</span>
    <span class="c1">// this assumes files 'application.conf', 'application.uat.conf', etc</span>
    <span class="k">val</span> <span class="nv">confFiles</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="s">""</span><span class="o">,</span> <span class="s">".prod"</span><span class="o">,</span> <span class="s">".uat"</span><span class="o">).</span><span class="py">map</span><span class="o">(</span><span class="n">s</span> <span class="k">=&gt;</span> <span class="n">s</span><span class="s">"application$s"</span><span class="o">)</span>
    <span class="s">"is valid and can be loaded by pure config"</span> <span class="o">-</span> <span class="o">{</span>
      <span class="nv">confFiles</span><span class="o">.</span><span class="py">foreach</span> <span class="o">{</span> <span class="n">file</span> <span class="k">=&gt;</span>
        <span class="n">s</span><span class="s">"Testing config for file $file.conf"</span> <span class="n">in</span> <span class="o">{</span>
          <span class="c1">// we load files explicitly, to avoid System.setValue magic</span>
          <span class="k">val</span> <span class="nv">tsfConfig</span> <span class="k">=</span> <span class="nv">ConfigFactory</span><span class="o">.</span><span class="py">load</span><span class="o">(</span><span class="n">file</span><span class="o">)</span>
          <span class="n">loadConfig</span><span class="o">[</span><span class="kt">Settings</span><span class="o">](</span><span class="n">tsfConfig</span><span class="o">)</span> <span class="k">match</span> <span class="o">{</span>
            <span class="k">case</span> <span class="nc">Success</span><span class="o">(</span><span class="k">_</span><span class="o">)</span> <span class="k">=&gt;</span>
              <span class="o">()</span>
            <span class="k">case</span> <span class="nc">Failure</span><span class="o">(</span><span class="n">ex</span><span class="o">)</span> <span class="k">=&gt;</span>
              <span class="nf">fail</span><span class="o">(</span><span class="n">s</span><span class="s">"Error loading configuration: $ex.\nProgram will now exit."</span><span class="o">,</span> <span class="n">ex</span><span class="o">)</span>
          <span class="o">}</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<p>With this we have removed most of the errors caused by bad configuration. You could even create a custom predicate to ensure the url of your servers are aiming to the right environment servers by using <a href="https://github.com/fthomas/refined">Refined</a>’s <code class="language-plaintext highlighter-rouge">Regex</code>.</p>

<p>I’m quite confident you will easily remember scenarios where stronger validation on your configuration would have saved you pain. We have achieved that, which is great, and all thanks to type safety.</p>

<p>But, can we do better?</p>

<h1 id="refining-your-model">Refining your model</h1>

<p>Let’s rescue the model we defined in the first section:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">FirstName</span><span class="o">(</span><span class="k">val</span> <span class="nv">firstName</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">AnyVal</span>
<span class="k">class</span> <span class="nc">LastName</span><span class="o">(</span><span class="k">val</span> <span class="nv">lastName</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">AnyVal</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">Person</span><span class="o">(</span><span class="n">firstName</span><span class="k">:</span> <span class="kt">FirstName</span><span class="o">,</span> <span class="n">lastName</span><span class="k">:</span> <span class="kt">LastName</span><span class="o">)</span>
</code></pre></div></div>

<p>This was an improvement over using <code class="language-plaintext highlighter-rouge">String</code> everywhere, but it still allows you to do this:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="nv">player</span> <span class="k">=</span> <span class="nc">Person</span><span class="o">(</span><span class="k">new</span> <span class="nc">FirstName</span><span class="o">(</span><span class="s">""</span><span class="o">),</span> <span class="k">new</span> <span class="nc">LastName</span><span class="o">(</span><span class="s">"Yagami"</span><span class="o">))</span>
</code></pre></div></div>

<p>Which may not be what you want, after all a first name is usually important. So we can convert this model to one that integrates <a href="https://github.com/fthomas/refined">Refined</a>, as we did with our configuration. It is quite easy:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">scala.util.Random</span>
<span class="k">import</span> <span class="nn">eu.timepit.refined._</span>
<span class="k">import</span> <span class="nn">eu.timepit.refined.auto._</span>
<span class="k">import</span> <span class="nn">eu.timepit.refined.api.Refined</span>
<span class="k">import</span> <span class="nn">eu.timepit.refined.collection.NonEmpty</span>

<span class="k">type</span> <span class="kt">NonEmptyString</span> <span class="o">=</span> <span class="nc">String</span> <span class="nc">Refined</span> <span class="nc">NonEmpty</span>
<span class="k">class</span> <span class="nc">FirstName</span><span class="o">(</span><span class="k">val</span> <span class="nv">firstName</span><span class="k">:</span> <span class="kt">NonEmptyString</span><span class="o">)</span>
<span class="k">class</span> <span class="nc">LastName</span><span class="o">(</span><span class="k">val</span> <span class="nv">lastName</span><span class="k">:</span> <span class="kt">NonEmptyString</span><span class="o">)</span>
 
<span class="k">case</span> <span class="k">class</span> <span class="nc">Person</span><span class="o">(</span><span class="n">firstName</span><span class="k">:</span> <span class="kt">FirstName</span><span class="o">,</span> <span class="n">lastName</span><span class="k">:</span> <span class="kt">LastName</span><span class="o">)</span>
<span class="nc">Person</span><span class="o">(</span><span class="k">new</span> <span class="nc">FirstName</span><span class="o">(</span><span class="s">""</span><span class="o">),</span> <span class="k">new</span> <span class="nc">LastName</span><span class="o">(</span><span class="s">"Yagami"</span><span class="o">))</span>
</code></pre></div></div>

<p>which will fail compilation with:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> error: type mismatch;
 found   : String("")
 required: NonEmptyString
    (which expands to)  eu.timepit.refined.api.Refined[String,eu.timepit.refined.boolean.Not[eu.timepit.refined.collection.Empty]]
    Person(new FirstName(""), new LastName("Yagami"))
                        ^
</code></pre></div></div>

<p>So we avoid more errors in our model thanks to typed. But, of course, most of our data is not hardcoded, but comes from external sources. If you try to define a single String variable and pass it to refine, it will complain at compile time about a type mistmatch. How do we solve this?</p>

<p>Refined itself provides the solution by allowing us to use the same refined types we defined for validation. An example:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">scala.util.Random</span>
<span class="k">import</span> <span class="nn">eu.timepit.refined._</span>
<span class="k">import</span> <span class="nn">eu.timepit.refined.string._</span>
<span class="k">import</span> <span class="nn">eu.timepit.refined.auto._</span>
<span class="k">import</span> <span class="nn">eu.timepit.refined.api.Refined</span>
<span class="k">import</span> <span class="nn">eu.timepit.refined.collection.NonEmpty</span>

<span class="k">type</span> <span class="kt">NonEmptyString</span> <span class="o">=</span> <span class="nc">String</span> <span class="nc">Refined</span> <span class="nc">NonEmpty</span>

<span class="k">val</span> <span class="nv">refinedNonEmptyName</span><span class="k">:</span> <span class="kt">Either</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">String</span> <span class="kt">Refined</span> <span class="kt">NonEmptyString</span><span class="o">]</span> <span class="k">=</span>
    <span class="n">refineV</span><span class="o">[</span><span class="kt">NonEmptyString</span><span class="o">](</span><span class="nf">if</span><span class="o">(</span><span class="nv">Random</span><span class="o">.</span><span class="py">nextBoolean</span><span class="o">())</span> <span class="s">""</span> <span class="k">else</span> <span class="s">"Light"</span><span class="o">)</span>
</code></pre></div></div>

<p>the snippet above uses <code class="language-plaintext highlighter-rouge">refineV</code> and our definition of <code class="language-plaintext highlighter-rouge">NonEmptyString</code> to create a validation method that returns an <code class="language-plaintext highlighter-rouge">Either</code>. If the string is valid we will gt a <code class="language-plaintext highlighter-rouge">Right(NonEmptyString)</code>, otherwise a <code class="language-plaintext highlighter-rouge">Left(String)</code> with the error message.</p>

<p>Initially this may look like additional boilerplate to restrict the types, and one may wonder if it is worth the effort. But the truth is we always need to validate data coming from outside the system and this approach forces us to make sure any contact with data outside our inner model is properly secured. You can’t be lazy and just accept a possibly wrong value when the compiler doesn’t allow you :)</p>

<p>At this point, if we stop and recap what we have done, we see that we have an application that has strongly typed configuration, avoiding common pitfalls like typos or bad selection of ports for the server.</p>

<p>Our application also has a clearly defined model that, by virtue of its types, makes it impossible to have invalid states like a person without a name. This is more important that in seems, as you know at the point you send the data to another service or when you render the details on a website that the value will always be present.</p>

<p>And, lastly, our application enforces, at compile time, that all the data that is used to generate our internal model has been validated. There is no scope to skip that, besides hardcoding a value, which ensures we reject invalid states from the outset.</p>

<p>But, again, can we do better?</p>

<h1 id="the-last-frontier-the-database">The last frontier: the database</h1>

<p>The summary above is lacking one last element: our interactions with the database. We like to use <a href="https://github.com/tpolecat/doobie">Doobie</a>, Typelevel’s pure functional JDBC layer for Scala, when working with the database.</p>

<p>As our model disallows invalid states we can assume that all the data in the database will be compliant and we just need for Doobie to build our case class from the data. Something like:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">def</span> <span class="nf">getAllPersons</span><span class="o">[</span><span class="kt">M</span><span class="o">[</span><span class="k">_</span><span class="o">]](</span><span class="n">xa</span><span class="k">:</span> <span class="kt">Transactor</span><span class="o">[</span><span class="kt">M</span><span class="o">])</span> <span class="k">=</span>
    <span class="n">sql</span><span class="s">"SELECT firstName, lastName FROM Person"</span>
      <span class="o">.</span><span class="py">query</span><span class="o">[</span><span class="kt">Person</span><span class="o">]</span>
      <span class="o">.</span><span class="py">process</span>
      <span class="o">.</span><span class="py">list</span>
      <span class="o">.</span><span class="py">transact</span><span class="o">(</span><span class="n">xa</span><span class="o">)</span>
</code></pre></div></div>

<p>Which is sound, and it would be great except… it doesn’t compile. Doobie currently doesn’t support Refined types. This could be a show stopper, as if we can’t store our perfect and valid model to a database, maybe it’s not so useful after all.</p>

<p>Luckily thanks to <a href="https://twitter.com/beefyhalo">@beefyhalo</a> an his comments on <a href="https://gitter.im/tpolecat/doobie/archives/2015/12/22">Gitter</a> we can add a couple of implicits that make things work:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// allows generation of doobie Meta objects from Refined types</span>
<span class="k">implicit</span> <span class="k">def</span> <span class="nf">refinedMeta</span><span class="o">[</span><span class="kt">T:</span> <span class="kt">Meta</span>, <span class="kt">P</span>, <span class="kt">F</span><span class="o">[</span><span class="k">_</span>, <span class="k">_</span><span class="o">]](</span><span class="k">implicit</span> <span class="n">tt</span><span class="k">:</span> <span class="kt">TypeTag</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="kt">T</span>, <span class="kt">P</span><span class="o">]],</span>
                                                <span class="n">ct</span><span class="k">:</span> <span class="kt">ClassTag</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="kt">T</span>, <span class="kt">P</span><span class="o">]],</span>
                                                <span class="n">validate</span><span class="k">:</span> <span class="kt">Validate</span><span class="o">[</span><span class="kt">T</span>, <span class="kt">P</span><span class="o">],</span>
                                                <span class="n">refType</span><span class="k">:</span> <span class="kt">RefType</span><span class="o">[</span><span class="kt">F</span><span class="o">])</span><span class="k">:</span> <span class="kt">Meta</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="kt">T</span>, <span class="kt">P</span><span class="o">]]</span> <span class="k">=</span>
    <span class="nc">Meta</span><span class="o">[</span><span class="kt">T</span><span class="o">].</span><span class="py">xmap</span><span class="o">(</span><span class="nv">refType</span><span class="o">.</span><span class="py">refine</span><span class="o">[</span><span class="kt">P</span><span class="o">](</span><span class="k">_</span><span class="o">)</span> <span class="k">match</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nc">Left</span><span class="o">(</span><span class="n">err</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="k">throw</span> <span class="nc">InvalidObjectMapping</span><span class="o">(</span><span class="nv">ct</span><span class="o">.</span><span class="py">runtimeClass</span><span class="o">,</span> <span class="nv">ct</span><span class="o">.</span><span class="py">getClass</span><span class="o">)</span>
      <span class="k">case</span> <span class="nc">Right</span><span class="o">(</span><span class="n">t</span><span class="o">)</span>  <span class="k">=&gt;</span> <span class="n">t</span>
    <span class="o">},</span> <span class="nv">refType</span><span class="o">.</span><span class="py">unwrap</span><span class="o">)</span>

<span class="c1">// allows generation of doobie Composite objects from Refined types</span>
<span class="k">implicit</span> <span class="k">def</span> <span class="nf">refinedComposite</span><span class="o">[</span><span class="kt">T:</span> <span class="kt">Composite</span>, <span class="kt">P</span>, <span class="kt">F</span><span class="o">[</span><span class="k">_</span>, <span class="k">_</span><span class="o">]](</span><span class="k">implicit</span> <span class="n">tt</span><span class="k">:</span> <span class="kt">TypeTag</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="kt">T</span>, <span class="kt">P</span><span class="o">]],</span>
                                                          <span class="n">ct</span><span class="k">:</span> <span class="kt">ClassTag</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="kt">T</span>, <span class="kt">P</span><span class="o">]],</span>
                                                          <span class="n">validate</span><span class="k">:</span> <span class="kt">Validate</span><span class="o">[</span><span class="kt">T</span>, <span class="kt">P</span><span class="o">],</span>
                                                          <span class="n">refType</span><span class="k">:</span> <span class="kt">RefType</span><span class="o">[</span><span class="kt">F</span><span class="o">])</span><span class="k">:</span>  <span class="kt">Composite</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="kt">T</span>, <span class="kt">P</span><span class="o">]]</span> <span class="k">=</span>
    <span class="nc">Composite</span><span class="o">[</span><span class="kt">T</span><span class="o">].</span><span class="py">imap</span><span class="o">(</span><span class="nv">refType</span><span class="o">.</span><span class="py">refine</span><span class="o">[</span><span class="kt">P</span><span class="o">](</span><span class="k">_</span><span class="o">)</span> <span class="k">match</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nc">Left</span><span class="o">(</span><span class="n">err</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="k">throw</span> <span class="nc">InvalidObjectMapping</span><span class="o">(</span><span class="nv">ct</span><span class="o">.</span><span class="py">runtimeClass</span><span class="o">,</span> <span class="nv">ct</span><span class="o">.</span><span class="py">getClass</span><span class="o">)</span>
      <span class="k">case</span> <span class="nc">Right</span><span class="o">(</span><span class="n">t</span><span class="o">)</span>  <span class="k">=&gt;</span> <span class="n">t</span>
    <span class="o">})(</span><span class="nv">refType</span><span class="o">.</span><span class="py">unwrap</span><span class="o">)</span>
</code></pre></div></div>

<p>With these Doobie is happy again and all your code compiles. Well, you can either use this or you can wait for <a href="https://github.com/tpolecat/doobie/pull/456">Doobie 0.4.2</a> to have direct native support!</p>

<p>And so, we have achieved it: now we have a strongly refined model for our application that brings the benefits of type safety from configuration to the database. No diminishing returns and minimal boilerplate on top, to bring the benefit of finding errors at compile time and to banish invalid state from your application.</p>

<p>Say goodbye to invalid state and the mysterious bugs it causes!</p>


        </article>

        <hr>

        
          <div class="row">
  <div class="col-sm-4 col-sm-offset-2">
    <h3 class="text-center">
      Like what you're reading?
    </h3>
    <p class="text-center">
      <a href="/blog/newsletters" class="btn btn-primary">
        Join our newsletter
        <span class="icon-uio-chevron-right "></span>
      </a>
    </p>
  </div>
</div>
        

        <hr>

        <h2 class="comments">Comments</h2>

<p>
  We encourage discussion of our blog posts on our <a href="https://gitter.im/underscoreio/scala">Gitter channel</a>.
  Please review our <a href="/terms#comments">Community Guidelines</a> before posting there.
  We encourage discussion in good faith, but do not allow combative, exclusionary, or harassing behaviour. 
  If you have any questions, <a href="/contact">contact us</a>!
</p>

      </section>
    </div>

    <div class="col-md-4">
      <aside class="blog-sidebar">
        <div id="mc_embed_signup" class="blog-sidebar-mailchimp panel panel-gray">
  <div class="panel-body">
    <h4>The Underscore Newsletter</h4>

    <p>Keep up to date! Subscribe to our newsletter for the latest Scala news.</p>

    <form method="post"
          action="http://underscoreconsulting.us3.list-manage.com/subscribe/post?u=a62dbb8a9c32f6c994dfd1111&amp;id=e9817b5369"
              id="mc-embedded-subscribe-form"
            name="mc-embedded-subscribe-form"
           class="validate"
          target="_blank"
      novalidate="">
      <fieldset>
        <div class="row">
          <div class="col-sm-12">
            <div class="form-group">
              <button class="btn btn-primary" id="mc-embedded-subscribe" type="submit" data-goal="click">Keep me posted</button>
            </div>
          </div>
        </div>
      </fieldset>
    </form>

    <p class="text-muted">
      <small>No spam. Unsubscribe at any time. We do not share personal details with third parties.</small>
    </p>

    <p class="text-muted">
      <small><a href="/blog/newsletters">Browse old newsletters to see what you'll get</a></small>
    </p>
  </div>
</div>
<div class="blog-sidebar-promos">
  <h4>Books from Underscore</h4>

  
  <div class="blog-sidebar-promo essential-scala"
     data-book-id="/books/essential-scala">
  <a class="book-title" href="/books/essential-scala">
    <span class="book-icon icon-uio-scala"></span>
    <span class="book-title-text">
      Essential Scala
    </span>

    <span class="pull-right">
      <span class="hidden-md">Read more</span>
      <span class="icon-uio-chevron-right "></span>
    </span>
  </a>
</div>


  
  <div class="blog-sidebar-promo scala-with-cats"
     data-book-id="/books/scala-with-cats">
  <a class="book-title" href="/books/scala-with-cats">
    <span class="book-icon icon-uio-cats"></span>
    <span class="book-title-text">
      Scala with Cats
    </span>

    <span class="pull-right">
      <span class="hidden-md">Read more</span>
      <span class="icon-uio-chevron-right "></span>
    </span>
  </a>
</div>


  
  <div class="blog-sidebar-promo essential-slick"
     data-book-id="/books/essential-slick">
  <a class="book-title" href="/books/essential-slick">
    <span class="book-icon icon-uio-scala"></span>
    <span class="book-title-text">
      Essential Slick
    </span>

    <span class="pull-right">
      <span class="hidden-md">Read more</span>
      <span class="icon-uio-chevron-right "></span>
    </span>
  </a>
</div>


  
  <div class="blog-sidebar-promo shapeless-guide"
     data-book-id="/books/shapeless-guide">
  <a class="book-title" href="/books/shapeless-guide">
    <span class="book-icon icon-uio-shapeless"></span>
    <span class="book-title-text">
      The Type Astronaut's Guide to Shapeless
    </span>

    <span class="pull-right">
      <span class="hidden-md">Read more</span>
      <span class="icon-uio-chevron-right "></span>
    </span>
  </a>
</div>

</div>

<aside class="blog-sidebar-archives">
  <h4>Archives</h4>

  <ul class="list-unstyled">
    
      
        <li class="heading">May 2020</li>
      

      <li><a href="/blog/posts/2020/05/27/scala-with-cats-2.html">Scala with Cats 2</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2020/05/14/porting-and-seq.html">Review Seq matching when porting to 2.13</a></li>
    
      
        
        
        
          <li class="heading">Dec 2019</li>
        
      

      <li><a href="/blog/posts/2019/12/23/talks-roundup.html">Our Talks from 2019</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2019/12/12/tut-to-mdoc.html">Tips for moving from tut to mdoc</a></li>
    
      
        
        
        
          <li class="heading">Jul 2019</li>
        
      

      <li><a href="/blog/posts/2019/07/04/introducing-inner-product.html">Introducing Inner Product</a></li>
    
      
        
        
        
          <li class="heading">Dec 2018</li>
        
      

      <li><a href="/blog/posts/2018/12/21/talks-roundup.html">Our Talks from 2018</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2018/12/12/bridges.html">Bridging Scala and the Front-End</a></li>
    
      
        
        
        
          <li class="heading">May 2018</li>
        
      

      <li><a href="/blog/posts/2018/05/17/modelling-js.html">Modelling JavaScript in Scala with Scala.js</a></li>
    
      
        
        
        
          <li class="heading">Mar 2018</li>
        
      

      <li><a href="/blog/posts/2018/03/20/fs2.html">Tips for working with FS2</a></li>
    
      
        
        
        
          <li class="heading">Dec 2017</li>
        
      

      <li><a href="/blog/posts/2017/12/14/scorex.html">A look at Scorex: a Scala blockchain framework</a></li>
    
      
        
        
        
          <li class="heading">Nov 2017</li>
        
      

      <li><a href="/blog/posts/2017/11/22/scala-with-cats.html">Announcing Scala with Cats</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2017/11/20/newsletter17.html">Newsletter 17: Season for Giving Edition</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2017/11/20/talks-from-team-underscore-at-scalax.html">Talks from Team Underscore at Scala Exchange</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2017/11/15/talks-to-watch-out-for-at-scalax.html">Talks to Watch Out For at Scala Exchange</a></li>
    
      
        
        
        
          <li class="heading">Sep 2017</li>
        
      

      <li><a href="/blog/posts/2017/09/05/review.html">Getting Into Other People's Code</a></li>
    
      
        
        
        
          <li class="heading">Jun 2017</li>
        
      

      <li><a href="/blog/posts/2017/06/02/uniting-church-and-state.html">Uniting Church and State: FP and OO Together</a></li>
    
      
        
        
        
          <li class="heading">May 2017</li>
        
      

      <li><a href="/blog/posts/2017/05/31/newsletter16.html">Newsletter 16: It's Book Time!</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2017/05/29/why-we-open-sourced-our-books.html">Why We Open Sourced our Books</a></li>
    
      
        
        
        
          <li class="heading">Apr 2017</li>
        
      

      <li><a href="/blog/posts/2017/04/11/type-tetris.html">Playing "Type Tetris"
</a></li>
    
      
        
        
        
          <li class="heading">Mar 2017</li>
        
      

      <li><a href="/blog/posts/2017/03/29/free-inject.html">The Free Monad with Multiple Algebras</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2017/03/07/refined-data-config-database.html">Refining your data from configuration to database</a></li>
    
      
        
        
        
          <li class="heading">Jan 2017</li>
        
      

      <li><a href="/blog/posts/2017/01/24/finch-functional-web-development.html">Finch: Functional Web Development</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2017/01/17/newsletter15.html">Newsletter 15: New Events in the New Year</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2017/01/17/agile-awards.html">Barclays Agile Awards 2016</a></li>
    
      
        
        
        
          <li class="heading">Dec 2016</li>
        
      

      <li><a href="/blog/posts/2016/12/16/newsletter14.html">Newsletter 14: Closing the Book on 2016</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2016/12/05/type-lambdas.html">Type lambdas and kind projector</a></li>
    
      
        
        
        
          <li class="heading">Nov 2016</li>
        
      

      <li><a href="/blog/posts/2016/11/24/value-discard.html">Value Discarding</a></li>
    
      
        
        
        
          <li class="heading">Oct 2016</li>
        
      

      <li><a href="/blog/posts/2016/10/11/twenty-two.html">Scala and 22</a></li>
    
      
        
        
        
          <li class="heading">Jul 2016</li>
        
      

      <li><a href="/blog/posts/2016/07/20/speaking-at-scalax.html">Giving a First Talk</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2016/07/20/new-speakers-at-scala-exchange-2016.html">How You Can Help Bring New Speakers and New Ideas to Scala eXchange 2016</a></li>
    
      
        
        
        
          <li class="heading">Jun 2016</li>
        
      

      <li><a href="/blog/posts/2016/06/27/opaque-transparent-interpreters.html">Opaque and Transparent Interpreters</a></li>
    
      
        
        
        
          <li class="heading">Apr 2016</li>
        
      

      <li><a href="/blog/posts/2016/04/21/probabilistic-programming.html">Probabilistic Programming in Scala</a></li>
    
      
        
        
        
          <li class="heading">Mar 2016</li>
        
      

      <li><a href="/blog/posts/2016/03/21/serverless-scale-summit.html">Scala.js is Important for Cloud Services</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2016/03/08/qcon.html">Types Working For You, Not Against You</a></li>
    
      
        
        
        
          <li class="heading">Feb 2016</li>
        
      

      <li><a href="/blog/posts/2016/02/02/advanced-scala-scalaz-to-cats.html">Advanced Scala Scalaz to Cats</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2016/02/01/aws-lambda.html">Scala and AWS Lambda Blueprints</a></li>
    
      
        
        
        
          <li class="heading">Jan 2016</li>
        
      

      <li><a href="/blog/posts/2016/01/19/typelevel-summits.html">Typelevel Summits</a></li>
    
      
        
        
        
          <li class="heading">Dec 2015</li>
        
      

      <li><a href="/blog/posts/2015/12/22/newsletter13.html">Newsletter 13: Christmas Loot Edition</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/12/21/scalax-slick-workshop.html">Video from the Slick Workshop at Scala Exchange 2015</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/12/21/scalax-interpreters-workshop.html">Slides and Code from the Interpreters Workshop at Scala Exchange 2015</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/12/18/tut.html">tut</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/12/18/scala-exchange-highlights.html">Highlights from Scala Exchange 2015</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/12/01/newsletter12.html">Newsletter 12: Scala Exchange</a></li>
    
      
        
        
        
          <li class="heading">Nov 2015</li>
        
      

      <li><a href="/blog/posts/2015/11/19/essential-slick-review-copies.html">Essential Slick Feature Complete and Review Copies Available</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/11/17/why-3x5-is-and-isnt-5x3.html">Why 3&times;5 is and isn't 5&times;3</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/11/09/sbt-commands.html">SBT Tricks</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/11/04/late-binding-and-overloading.html">Late Binding and Overloading in Scala</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/11/03/atom.html">Using the Atom Editor with Scala</a></li>
    
      
        
        
        
          <li class="heading">Oct 2015</li>
        
      

      <li><a href="/blog/posts/2015/10/14/reification.html">Reification, Kleislis, and Stream Libraries</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/10/01/newsletter11.html">Newsletter 11: Books and Boxes</a></li>
    
      
        
        
        
          <li class="heading">Sep 2015</li>
        
      

      <li><a href="/blog/posts/2015/09/16/book-update.html">Updates on the Underscore Books</a></li>
    
      
        
        
        
          <li class="heading">Aug 2015</li>
        
      

      <li><a href="/blog/posts/2015/08/28/essential-slick.html">Essential Slick Updates</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/08/23/slick-getresults.html">Using slickless with Plain SQL</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/08/08/slickless.html">Using shapeless HLists with Slick 3</a></li>
    
      
        
        
        
          <li class="heading">Jul 2015</li>
        
      

      <li><a href="/blog/posts/2015/07/24/diversity.html">You Can Increase Diversity at Scala eXchange</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/07/21/simple-isnt-easy.html">Simple Isn't Easy</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/07/14/upsert.html">Upsert in Slick 3</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/07/03/newsletter10.html">Newsletter 10: Conferences, Cats, and Robots from the Future</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/07/02/annihilators-in-scala.html">Annihilators in Scala: An Example of Type Class Design</a></li>
    
      
        
        
        
          <li class="heading">Jun 2015</li>
        
      

      <li><a href="/blog/posts/2015/06/25/keeping-scala-simple.html">Keeping Scala Simple</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/06/10/scalajs-scaladays.html">Towards Browser and Server Utopia with Scala.js</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/06/10/an-introduction-to-cats.html">An Introduction to Cats</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/06/05/new-speakers-at-scala-exchange-2015.html">New Speakers at Scala Exchange 2015</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/06/04/newsletter9.html">Newsletter 9: Scala Jobs, Slick, Sealed Traits, Strata, and Scala Days</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/06/04/more-on-sealed.html">More on Sealed Traits in Scala</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/06/02/everything-about-sealed.html">Everything You Ever Wanted to Know About Sealed Traits in Scala</a></li>
    
      
        
        
        
          <li class="heading">May 2015</li>
        
      

      <li><a href="/blog/posts/2015/05/28/typechecking-sql.html">Typechecking SQL in Slick and doobie</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/05/15/slick-enrichment.html">Slick Query Enrichment</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/05/14/strata-hadoop-world.html">Strata + Hadoop World London 2015 In Review</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/05/06/essential-slick.html">Introducing Essential Slick</a></li>
    
      
        
        
        
          <li class="heading">Apr 2015</li>
        
      

      <li><a href="/blog/posts/2015/04/30/newsletter8.html">Newsletter 8: Free Monads and Free Courses</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/04/28/monadic-io-laziness-makes-you-free.html">Monadic IO: Laziness Makes You Free</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/04/24/distributed-teams.html">Practices for Distributed Scala Teams</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/04/23/deriving-the-free-monad.html">Deriving the Free Monad</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/04/14/free-monads-are-simple.html">Free Monads Are Simple</a></li>
    
      
        
        
        
          <li class="heading">Mar 2015</li>
        
      

      <li><a href="/blog/posts/2015/03/13/rxlift.html">RxLift: Reactive Web Components with LiftWeb and RxScala</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/03/05/newsletter7.html">Newsletter 7: Error Handling and Two New Books</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/03/05/compositional-music-composition.html">Compositional Music Composition</a></li>
    
      
        
        
        
          <li class="heading">Feb 2015</li>
        
      

      <li><a href="/blog/posts/2015/02/25/creative-scala-released.html">Creative Scala: A New Introduction to Scala</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/02/23/designing-fail-fast-error-handling.html">Designing Fail-Fast Error Handling</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/02/13/error-handling-without-throwing-your-hands-up.html">Error Handling Without Throwing Your Hands Up</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/02/09/newsletter6.html">Newsletter 6: Training and Diversity Online and Worldwide</a></li>
    
      
        
        
        
          <li class="heading">Jan 2015</li>
        
      

      <li><a href="/blog/posts/2015/01/29/rethinking-online-training.html">Rethinking Online Training</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/01/29/diversity-in-training.html">Diversity in Training</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/01/16/lift-26-release.html">Highlights of the Lift Web Framework 2.6 Release</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/01/14/new-speakers-at-scala-exchange.html">Roundup of the New Speakers at Scala Exchange</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/01/05/codereview.html">Code Review at Scala eXchange</a></li>
    
      
        
        
        
          <li class="heading">Dec 2014</li>
        
      

      <li><a href="/blog/posts/2014/12/16/essential-scala-and-play-books-available-for-early-access.html">Essential Scala and Play Books Available for Early Access</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/12/05/newsletter5.html">Newsletter 5: Xmas Reading</a></li>
    
      
        
        
        
          <li class="heading">Oct 2014</li>
        
      

      <li><a href="/blog/posts/2014/10/20/newsletter4.html">Newsletter 4</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/10/20/essential-esential-scala-at-hack-the-tower.html">Essential Essential Scala at Hack the Tower</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/10/17/new-speakers-at-scala-exchange.html">New Speakers at Scala Exchange</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/10/02/learn-shapeless-find-500-dollars.html">Learn Shapeless, Find $500</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/10/01/intro-functional-finance.html">Introducing Functional Finance</a></li>
    
      
        
        
        
          <li class="heading">Sep 2014</li>
        
      

      <li><a href="/blog/posts/2014/09/16/response-to-the-typelevel-fork.html">Our Response to the Typelevel fork of Scala</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/09/03/enumerations.html">Scala Enumerations</a></li>
    
      
        
        
        
          <li class="heading">Aug 2014</li>
        
      

      <li><a href="/blog/posts/2014/08/28/tools-to-guide-code-quality.html">Tools to guide code quality</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/08/17/angularjs-vs-react.html">AngularJs vs React</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/08/07/newsletter3.html">Newsletter 3</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/08/07/scala-exchange-nsap-last-call.html">Scala Exchange New Speaker Programme Closing Soon</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/08/05/code-reviews-dont-produce-quality-code.html">Code Reviews Don't Produce Quality Code</a></li>
    
      
        
        
        
          <li class="heading">Jul 2014</li>
        
      

      <li><a href="/blog/posts/2014/07/27/readerwriterstate.html">A Small (Real) Example of the Reader and Writer Monads</a></li>
    
      
        
        
        
          <li class="heading">Jun 2014</li>
        
      

      <li><a href="/blog/posts/2014/06/30/underscores-new-speaker-program.html">Underscore's New Speaker Program for Scala Exchange</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/06/24/scala-days-2014-the-lowdown.html">Scala Days 2014: The Low-down</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/06/21/announcing-underscoreio.html">Announcing underscore.io</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/06/05/lambda.html">Java 8 Crib Sheet for Scala Developers</a></li>
    
      
        
        
        
          <li class="heading">May 2014</li>
        
      

      <li><a href="/blog/posts/2014/05/02/hiring-scala-developers.html">Hiring Scala Developers</a></li>
    
      
        
        
        
          <li class="heading">Apr 2014</li>
        
      

      <li><a href="/blog/posts/2014/04/30/newsletter2.html">Newsletter 2</a></li>
    
      
        
        
        
          <li class="heading">Mar 2014</li>
        
      

      <li><a href="/blog/posts/2014/03/18/newsletter1.html">Newsletter 1</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/03/10/teaching-scala.html">Teaching Scala</a></li>
    
      
        
        
        
          <li class="heading">Jan 2014</li>
        
      

      <li><a href="/blog/posts/2014/01/29/unboxed-tagged-angst.html">Unboxed Tagged Angst</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/01/06/crdt.html">Collaborative Text Editing</a></li>
    
      
        
        
        
          <li class="heading">Dec 2013</li>
        
      

      <li><a href="/blog/posts/2013/12/20/scalaz-monad-transformers.html">Scalaz Monad Transformers</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2013/12/20/crdts-for-fun-and-eventual-profit.html">CRDTs for fun and eventual profit</a></li>
    
      
        
        
        
          <li class="heading">Oct 2013</li>
        
      

      <li><a href="/blog/posts/2013/10/01/functional-media-roundup-quality-counts.html">Functional Media Roundup: Quality Counts</a></li>
    
      
        
        
        
          <li class="heading">Aug 2013</li>
        
      

      <li><a href="/blog/posts/2013/08/01/lift.html">Lift Cookbook</a></li>
    
      
        
        
        
          <li class="heading">Jul 2013</li>
        
      

      <li><a href="/blog/posts/2013/07/09/media-panel.html">Functional Programming in Media and Publishing</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2013/07/03/cloudbees.html">CloudBees Service Partner</a></li>
    
      
        
        
        
          <li class="heading">Mar 2013</li>
        
      

      <li><a href="/blog/posts/2013/03/13/streaming-algorithms-preregister.html">Pre-register for Streaming Algorithms Course</a></li>
    
      
        
        
        
          <li class="heading">Oct 2012</li>
        
      

      <li><a href="/blog/posts/2012/10/16/a-tribute-to-phil-bagwell.html">A Tribute to Phil Bagwell</a></li>
    
      
        
        
        
          <li class="heading">Aug 2012</li>
        
      

      <li><a href="/blog/posts/2012/08/01/developer-price.html">Misconceptions about Scala Developer Rates</a></li>
    
      
        
        
        
          <li class="heading">Jul 2012</li>
        
      

      <li><a href="/blog/posts/2012/07/09/another-typeclass.html">Another Small Example of the Type Class Pattern</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2012/07/06/icml-review.html">Review of COLT and ICML</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2012/07/02/kleisli-arrows.html">A Small Example of Kleisli Arrows</a></li>
    
      
        
        
        
          <li class="heading">Jun 2012</li>
        
      

      <li><a href="/blog/posts/2012/06/16/phantom-types.html">A Small Example of Phantom Types</a></li>
    
      
        
        
        
          <li class="heading">May 2012</li>
        
      

      <li><a href="/blog/posts/2012/05/03/typeclasses.html">A Small Example of the Typeclass Pattern</a></li>
    
  </ul>
</aside>

      </aside>
    </div>
  </div>
</section>

<footer>
  <div class="container">
    <div class="text-center">
      <img src="/images/common/footer-brand.png" class="footer-brand" alt="Underscore">
    </div>

    <div class="row sitemap">
      <div class="col-sm-6 col-md-4">
        <h5><a href="/">Underscore</a></h5>
        <ul class="list-unstyled">
          <li><a href="/">Home</a></li>
          <li><a href="/consulting">Our Services</a></li>
          <li><a href="/privacy">Privacy Policy</a></li>
          <li class="currency-select">
            Currency:
            <a href="javascript:void(0)" class="currency-select-usd">USD</a>,
            <a href="javascript:void(0)" class="currency-select-gbp">GBP</a>,
            <a href="javascript:void(0)" class="currency-select-eur">EUR</a>
          </li>
        </ul>
      </div>

      <div class="col-sm-6 col-md-4">
        <h5><a href="/training">Courses and Training</a></h5>
        <ul class="list-unstyled">
          <li><a href="/training/bookings">Book a Course</a></li>
          <li><a href="/training">Course Directory</a></li>
          <li><a href="/training/courses/essential-scala">Essential Scala</a></li>
          <li><a href="/training/courses/advanced-scala">Advanced Scala with Cats</a></li>
        </ul>
      </div>

      <div class="col-sm-6 col-md-4">
        <h5><a href="/contact">Contact</a></h5>
        <ul class="list-unstyled">
          <li><a href="/contact">
            <span class="icon-uio-envelope "></span>
            hello@underscore.io
          </a></li>
          <li><a href="http://twitter.com/underscoreio">
            <span class="icon-uio-twitter "></span>
            @underscoreio
          </a></li>
          <li><a href="/blog/newsletters">
            <span class="icon-uio-public "></span>
            The Underscore Newsletter
          </a></li>
        </ul>
      </div>
    </div>

    <p class="copyright text-center">
      Copyright 2011&ndash;22.
      <br class="visible-xs">
      All rights reserved. <a href="/terms">Terms of use</a>
    </p>
  </div>
</footer>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-29444727-2', 'underscore.io');
      ga('send', 'pageview');
    </script>
  </body>
</html>
