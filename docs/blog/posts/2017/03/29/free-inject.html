<!DOCTYPE html>
<html lang="en" id="/blog/posts/2017/03/29/free-inject" class="">
  
  
  <head>
    <title>The Free Monad with Multiple Algebras - Underscore</title>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link type="text/css" rel="stylesheet" href="/assets/screen-9132d4f189ef656eb3d1e8defedf7c83e32e9240d9a3af3d804d36f850e43dd5.css">
    <link type="text/css" rel="stylesheet" href="/assets/print-dd04f6182ddcf193d2ac9f59bdbdbb366e01738f8a32086ffb82c7be2f9e1eb8.css" media="print">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@underscoreio">
    
      <meta name="twitter:title" content="The Free Monad with Multiple Algebras">
    
    
      <meta name="twitter:description" content="In this post I will look at the machinery that makes it possible to use Free with more than one algebra at once: Coproducts and the Inject type class.
This technique was first described in the paper Data types à la carte, and Cats and other libraries provide implementations.
However we’re going to build our own implementation in this post, so we understand how it all works.
I’m going to assume you understand Free at a basic level.
If not, there are several good posts that introduce the concept.

">
    
    
      <meta name="twitter:image" content="http://underscore.io/images/twitter-card-icon.png">
    

    <link rel="shortcut icon" href="/images/favicon-64.png">
    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
    <link rel="alternate" type="application/rss+xml" title="RSS" href="/blog/feed.xml">

    <link rel="canonical" href="http://underscore.io/blog/posts/2017/03/29/free-inject.html">

    <script type="text/javascript" src="/assets/site-5ab8e41df06f32ccfbf4c40fdf2d7fc81c360b991aa5c153ed01fd0714c019d4.js"></script>
  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/"><span class="icon-uio-underscore "></span></a>
    </div>

    <div class="navbar-collapse">
      <ul class="nav navbar-nav navbar-right visible-md visible-lg">
        <li class="divider"></li>
        <li class="social"><a href="http://twitter.com/underscoreio"><span class="icon-uio-twitter "></span><span class="sr-only">Twitter</span></a></li>
        <li class="social"><a href="/contact"><span class="icon-uio-envelope "></span><span class="sr-only">Email</span></a></li>
      </ul>

      <ul class="nav navbar-nav navbar-right">
        <li class="visible-xs "><a href="/">Home</a></li>
        <li class=""><a href="/development">Development</a></li>
        <li class=""><a href="/consulting">Consulting</a></li>
        <li class=""><a href="/training">Training</a></li>
        <!-- li class=""><a href="/books">Books</a></li -->
        <li class=""><a href="/company">Company</a></li>
      </ul>
    </div>
  </div>
</nav>


<div class="hero">
  <div class="overlay-gem-left-white hero-overlay-soft"></div>
  <div class="overlay-gem-right-white hero-overlay-soft"></div>
  <div class="overlay-arrow-white-inverse"></div>

  <nav class="navbar navbar-inverse" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/"><span class="icon-uio-underscore "></span></a>
    </div>

    <div class="navbar-collapse">
      <ul class="nav navbar-nav navbar-right visible-md visible-lg">
        <li class="divider"></li>
        <li class="social"><a href="http://twitter.com/underscoreio"><span class="icon-uio-twitter "></span><span class="sr-only">Twitter</span></a></li>
        <li class="social"><a href="/contact"><span class="icon-uio-envelope "></span><span class="sr-only">Email</span></a></li>
      </ul>

      <ul class="nav navbar-nav navbar-right">
        <li class="visible-xs "><a href="/">Home</a></li>
        <li class=""><a href="/development">Development</a></li>
        <li class=""><a href="/consulting">Consulting</a></li>
        <li class=""><a href="/training">Training</a></li>
        <!-- li class=""><a href="/books">Books</a></li -->
        <li class=""><a href="/company">Company</a></li>
      </ul>
    </div>
  </div>
</nav>


  <header class="hero-text">
    <div class="container">
      
        <h1>
          <a class="back-link" href="/blog">
            Blog
            <span class="icon-uio-back "></span>
          </a>
        </h1>
      

      
    </div>
  </header>
</div>


<section class="container">
  <div class="row">
    <div class="col-md-8">
      <section class="blog-post" data-post-url="/blog/posts/2017/03/29/free-inject.html">
        <h2 class="blog-post-title">The Free Monad with Multiple Algebras</h2>

        <dl class="blog-post-meta">
  <dt class="blog-post-date">Posted</dt>
  <dd class="blog-post-date">
    <span class="day">29</span>
    <span class="month">Mar</span>
    <span class="year">2017</span>
  </dd>
  <dt class="blog-post-author">by</dt>
  <dd class="blog-post-author">
    Danielle Ashley
  </dd>
  
</dl>


        <article class="blog-post-content">
          <p>In this post I will look at the machinery that makes it possible to use <code class="language-plaintext highlighter-rouge">Free</code> with more than one algebra at once: <code class="language-plaintext highlighter-rouge">Coproducts</code> and the <code class="language-plaintext highlighter-rouge">Inject</code> type class.
This technique was first described in the paper <a href="http://www.staff.science.uu.nl/~swier004/publications/2008-jfp.pdf">Data types à la carte</a>, and <a href="http://typelevel.org/cats/">Cats</a> and other libraries provide implementations.
However we’re going to build our own implementation in this post, so we understand how it all works.
I’m going to assume you understand <code class="language-plaintext highlighter-rouge">Free</code> at a basic level.
If not, there are <a href="/blog/posts/2015/04/14/free-monads-are-simple.html">several</a> <a href="http://perevillega.com/understanding-free-monads">good</a> <a href="https://blog.scalac.io/2016/06/02/overview-of-free-monad-in-cats.html">posts</a> that introduce the concept.</p>

<!-- break -->

<p>The usual scenario with the <code class="language-plaintext highlighter-rouge">Free</code> monad is that of constructing DSLs: representing computations as immutable values and separating their execution into a separate structure known as an interpreter.
<a href="/blog/posts/2015/10/14/reification.html">Reifying</a> the steps of a procedure or computation in order to represent them without actually executing them is a very common implementation strategy in functional programming.
We would normally represent these steps, or actions, as an algebraic data type, without necessarily providing an implementation at the same time.
Here is a very simple example of a set of operations represented in this way:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">Action</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="c1">// parameterised on return type</span>
<span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">ReadData</span><span class="o">(</span><span class="n">port</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Action</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span>
<span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">TransformData</span><span class="o">(</span><span class="n">data</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Action</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span>
<span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">WriteData</span><span class="o">(</span><span class="n">port</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">data</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Action</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span>
</code></pre></div></div>

<p>Note how none of the types above have implementations, they are purely descriptive.</p>

<p>So, what good is it?
It starts to look more useful when we imagine being able to sequence these things and compose them with other actions, using them as building blocks of bigger abstract ‘programs’. (The obvious example here would be sequencing <code class="language-plaintext highlighter-rouge">ReadData</code> and then <code class="language-plaintext highlighter-rouge">TransformData</code> and then <code class="language-plaintext highlighter-rouge">WriteData</code> into a combined action)
As they are at the moment, though, we can’t compose these directly; right now we have defined no mechanism to allow it. We could go and write some methods on <code class="language-plaintext highlighter-rouge">Action</code> for this purpose, but there is a more general way: if this ‘instruction set’ was a monad, we could sequence instructions in a <code class="language-plaintext highlighter-rouge">for</code> comprehension, for example.
And there is no need to make <code class="language-plaintext highlighter-rouge">Action</code> a monad ‘manually’, either: a practical way of achieving the same is by wrapping these types into the <code class="language-plaintext highlighter-rouge">Free</code> monad.
(For a more general discussion of <code class="language-plaintext highlighter-rouge">Free</code> please see any of the references to this post. For now, we’ll just use it in a practical context to lead us to the next topic, multiple algebras.)</p>

<p>In Cats, the <code class="language-plaintext highlighter-rouge">Free</code> monad is already defined for us, and we can ‘lift’ a type constructor into the it with <code class="language-plaintext highlighter-rouge">Free.liftF</code>.
Let us write a little bit of boilerplate to help us do that:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">object</span> <span class="nc">ActionFree</span> <span class="o">{</span>
  <span class="k">def</span> <span class="nf">readData</span><span class="o">(</span><span class="n">port</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Free</span><span class="o">[</span><span class="kt">Action</span>, <span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nv">Free</span><span class="o">.</span><span class="py">liftF</span><span class="o">(</span><span class="nc">ReadData</span><span class="o">(</span><span class="n">port</span><span class="o">))</span>
  <span class="k">def</span> <span class="nf">transformData</span><span class="o">(</span><span class="n">data</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Free</span><span class="o">[</span><span class="kt">Action</span>, <span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nv">Free</span><span class="o">.</span><span class="py">liftF</span><span class="o">(</span><span class="nc">TransformData</span><span class="o">(</span><span class="n">data</span><span class="o">))</span>
  <span class="k">def</span> <span class="nf">writeData</span><span class="o">(</span><span class="n">port</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">data</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Free</span><span class="o">[</span><span class="kt">Action</span>, <span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span> <span class="nv">Free</span><span class="o">.</span><span class="py">liftF</span><span class="o">(</span><span class="nc">WriteData</span><span class="o">(</span><span class="n">port</span><span class="o">,</span> <span class="n">data</span><span class="o">))</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The general pattern above is to turn an <code class="language-plaintext highlighter-rouge">F[A]</code> into a <code class="language-plaintext highlighter-rouge">Free[F, A]</code> so we have access to the monadic operations such as <code class="language-plaintext highlighter-rouge">flatMap</code> provided by <code class="language-plaintext highlighter-rouge">Free</code>.</p>

<p>Now we can do this:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">ActionFree._</span>
<span class="k">val</span> <span class="nv">program</span> <span class="k">=</span> <span class="k">for</span> <span class="o">{</span>
  <span class="n">d</span> <span class="k">&lt;-</span> <span class="nf">readData</span><span class="o">(</span><span class="mi">123</span><span class="o">)</span>
  <span class="n">t</span> <span class="k">&lt;-</span> <span class="nf">transformData</span><span class="o">(</span><span class="n">d</span><span class="o">)</span>
  <span class="k">_</span> <span class="k">&lt;-</span> <span class="nf">writeData</span><span class="o">(</span><span class="mi">789</span><span class="o">,</span> <span class="n">t</span><span class="o">)</span>
<span class="o">}</span> <span class="nf">yield</span> <span class="o">()</span>
<span class="c1">// program: Free[Action, Unit]</span>
</code></pre></div></div>

<p>We can then take <code class="language-plaintext highlighter-rouge">program</code> and in turn compose it with other structures with the same signature.</p>

<p>(Note that in the convenience methods defined in <code class="language-plaintext highlighter-rouge">ActionFree</code>, we ensure that the resulting instances of <code class="language-plaintext highlighter-rouge">Free</code> are of type <code class="language-plaintext highlighter-rouge">Free[Action, A]</code> rather than allowing the compiler’s type inference to narrow them excessively and end up with a too-specific <code class="language-plaintext highlighter-rouge">Free[ReadData, A]</code> which wouldn’t compose with e.g. <code class="language-plaintext highlighter-rouge">Free[WriteData, A]</code>.)</p>

<h2 id="multiple-dsls">Multiple DSLs</h2>

<p>The interesting part is yet to come.
One of the main attractions of going down this avenue is the possibility of mixing ‘instruction sets’ and still getting them to compose.</p>

<p>Back to our example, we want to do more with data besides reading, writing and ‘transforming’ it. We want to add the following operations:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">EncryptData</span><span class="o">(</span><span class="n">key</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>
<span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">DecryptData</span><span class="o">(</span><span class="n">key</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>
</code></pre></div></div>

<p>But let’s assume that we can’t just make them subclasses of <code class="language-plaintext highlighter-rouge">Action</code>, because <code class="language-plaintext highlighter-rouge">Action</code> is a <code class="language-plaintext highlighter-rouge">sealed</code> trait in a library over which we have no control (or for other good conceptual or architecture reasons).
Whatever the reason, imagine that this is how we end up writing them:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">AdvancedAction</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
<span class="nc">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">EncryptData</span><span class="o">(</span><span class="n">key</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">AdvancedAction</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span>
<span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">DecryptData</span><span class="o">(</span><span class="n">key</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">AdvancedAction</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">Action</code> and <code class="language-plaintext highlighter-rouge">AdvancedAction</code> are separate data types. They have no meaningful common supertype. How can we group them so we can build programs from commands of each type?</p>

<p>(Let’s remind ourselves that we’re not concerned with how any of these combined operations will be executed in practice. We simply want to find a suitable <em>representation</em> for them. Executing will be the job of the <em>interpreter</em> of our DSL.)</p>

<p>If we wanted to make use of operations from both <code class="language-plaintext highlighter-rouge">Action[A]</code> and <code class="language-plaintext highlighter-rouge">AdvancedAction[A]</code>, Cats offers a <code class="language-plaintext highlighter-rouge">Coproduct</code> type we can use, which is roughly an <code class="language-plaintext highlighter-rouge">Either</code> but for higher kinded types. The idea is to use this to ‘merge’ the two algebras into a common type.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="kt">ActionOrAdvanced</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Coproduct</span><span class="o">[</span><span class="kt">Action</span>, <span class="kt">AdvancedAction</span>, <span class="kt">A</span><span class="o">]</span>
</code></pre></div></div>

<p>We would like to use the newly-defined <code class="language-plaintext highlighter-rouge">ActionOrAdvanced</code> in place of either <code class="language-plaintext highlighter-rouge">Action</code> alone or <code class="language-plaintext highlighter-rouge">AdvancedAction</code> alone. At least in principle this should work and give us a way to do what we want.
We would end up with <code class="language-plaintext highlighter-rouge">Free</code> instances of type <code class="language-plaintext highlighter-rouge">Free[ActionOrAdvanced, A]</code>.</p>

<p>But how would it work in practice?</p>

<p>If you’ve been reading other posts on this subject, this is the point where, usually, the word ‘inject’ starts to appear, requiring an act of faith on the part of any readers who haven’t encountered it before, and quite possibly at the same point their ability to follow what’s going on may begin to waver.
So, let’s look at <code class="language-plaintext highlighter-rouge">Coproduct</code> and <code class="language-plaintext highlighter-rouge">Inject</code> in more detail to find out how they work, as they rely on a very interesting type-level mechanism.</p>

<h2 id="coproduct-basics">Coproduct Basics</h2>

<p>Before getting too far ahead, let’s have a look at how <code class="language-plaintext highlighter-rouge">Coproduct</code> works, to get familiar with it.
Let’s take this example:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="kt">MyCoproduct</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Coproduct</span><span class="o">[</span><span class="kt">List</span>, <span class="kt">Option</span>, <span class="kt">A</span><span class="o">]</span>
</code></pre></div></div>
<p>A reminder that the above is akin to saying <code class="language-plaintext highlighter-rouge">Either[List[A], Option[A]]</code> <em>for any <code class="language-plaintext highlighter-rouge">A</code></em>.</p>

<p>Now, assuming I have a <code class="language-plaintext highlighter-rouge">List</code>, how do I ‘put it’ inside a coproduct?
Like this:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="nv">c1</span><span class="k">:</span> <span class="kt">MyCoproduct</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nv">Coproduct</span><span class="o">.</span><span class="py">leftc</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">))</span>
<span class="c1">// c1 = Coproduct(Left(List(1, 2, 3)))</span>
</code></pre></div></div>
<p>Similarly if I have an <code class="language-plaintext highlighter-rouge">Option</code>:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="nv">c2</span><span class="k">:</span> <span class="kt">MyCoproduct</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nv">Coproduct</span><span class="o">.</span><span class="py">rightc</span><span class="o">(</span><span class="nc">Some</span><span class="o">(</span><span class="mi">5</span><span class="o">))</span>
<span class="c1">// c2 = Coproduct(Right(Some(5)))</span>
</code></pre></div></div>

<p>So, as per the original definition of <code class="language-plaintext highlighter-rouge">MyCoproduct</code>, <code class="language-plaintext highlighter-rouge">List</code> is left, <code class="language-plaintext highlighter-rouge">Option</code> is right, and everything makes sense. If I try it any other way, it predictably fails:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// trying to put an Option on the left</span>
<span class="k">val</span> <span class="nv">c3</span><span class="k">:</span> <span class="kt">MyCoproduct</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nv">Coproduct</span><span class="o">.</span><span class="py">leftc</span><span class="o">(</span><span class="nc">Some</span><span class="o">(</span><span class="mi">7</span><span class="o">))</span>
<span class="c1">// Error: type mismatch</span>
<span class="c1">// found   : Some[Int]</span>
<span class="c1">// required: List[Int]</span>
</code></pre></div></div>

<p>Let’s apply this to our DSL example. One possibility would be to directly use <code class="language-plaintext highlighter-rouge">leftc</code> and <code class="language-plaintext highlighter-rouge">rightc</code> in the convenience methods that create the <code class="language-plaintext highlighter-rouge">Free</code> instances we need:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">object</span> <span class="nc">NaiveActionFree</span> <span class="o">{</span>
  <span class="k">def</span> <span class="nf">readData</span><span class="o">(</span><span class="n">port</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Free</span><span class="o">[</span><span class="kt">ActionOrAdvanced</span>, <span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nv">Free</span><span class="o">.</span><span class="py">liftF</span><span class="o">[</span><span class="kt">ActionOrAdvanced</span>, <span class="kt">String</span><span class="o">](</span><span class="nv">Coproduct</span><span class="o">.</span><span class="py">leftc</span><span class="o">(</span><span class="nc">ReadData</span><span class="o">(</span><span class="n">port</span><span class="o">)))</span>
  <span class="c1">//...</span>
<span class="o">}</span>
</code></pre></div></div>

<p>We would then do a similar thing for the case classes of <code class="language-plaintext highlighter-rouge">AdvancedAction</code>
Note, though, that in so doing we are tied to the particular coproduct we are choosing to use at the moment: first of all, we mention it by name (in the type arguments to <code class="language-plaintext highlighter-rouge">liftF</code>) and we rely on the knowledge that in it <code class="language-plaintext highlighter-rouge">ReadData</code> is on the left side (otherwise it wouldn’t compile).
This in turn means that if we want to use another type of coproduct, i.e. another mix of DSLs (it’s easy to imagine wanting to add more instructions later!), the code snippet above (and all of the convenience methods thus defined) will have to be scrapped and rewritten.
Nobody likes doing that, so is there a more automatic solution?</p>

<h2 id="inject">Inject</h2>

<p>Let’s envision a typeclass that, given a type and a coproduct, ‘knows’ how to correctly lift it to the coproduct level.
Introducing <code class="language-plaintext highlighter-rouge">Inject</code>, defined thusly:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">trait</span> <span class="nc">Inject</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]</span>, <span class="kt">G</span><span class="o">[</span><span class="k">_</span><span class="o">]]</span> <span class="o">{</span>
  <span class="k">def</span> <span class="nf">inj</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">G</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
<span class="o">}</span>
</code></pre></div></div>

<p>(N.B. The code above is a simplification of the actual library code available in <code class="language-plaintext highlighter-rouge">cats</code>.)</p>

<p><code class="language-plaintext highlighter-rouge">Inject</code> is a type class that allows us to embed one algebra within another.
An instance of <code class="language-plaintext highlighter-rouge">Inject[Action, ActionOrAdvanced]</code>, for example, allows us to ‘lift’ instances of <code class="language-plaintext highlighter-rouge">Action</code> to type <code class="language-plaintext highlighter-rouge">ActionOrAdvanced</code>.</p>

<p>(As an aside, you may notice that <code class="language-plaintext highlighter-rouge">Inject</code> has the same type structure as a natural transformation. This is no coincidence: in a sense, an instance <code class="language-plaintext highlighter-rouge">Inject[F, G]</code> allows us to ‘interpret’ instances of <code class="language-plaintext highlighter-rouge">F</code> as <code class="language-plaintext highlighter-rouge">G</code>. However, the similarity is effectively academic.
In practice we use <code class="language-plaintext highlighter-rouge">Inject</code> to embed algebras in coproducts and <code class="language-plaintext highlighter-rouge">~&gt;</code> to interpret them to meaningful results.)</p>

<p>Is it possible to come up with a way to automatically derive an instance of <code class="language-plaintext highlighter-rouge">Inject</code> so that stuffing our <code class="language-plaintext highlighter-rouge">Coproduct</code> types happened by magic?</p>

<h3 id="left-hand">Left Hand</h3>

<p>Let’s start by examining the case where <code class="language-plaintext highlighter-rouge">F</code> is our DSL and <code class="language-plaintext highlighter-rouge">G</code> is a coproduct with our desired type <code class="language-plaintext highlighter-rouge">F</code> on the left-hand side. That is, <code class="language-plaintext highlighter-rouge">G[A]</code> is <code class="language-plaintext highlighter-rouge">Coproduct[F,X,A]</code>, that is to say, a coproduct with our desired type on the left hand side. Then, writing an instance for this case is as simple as calling <code class="language-plaintext highlighter-rouge">leftc</code> as we did in the examples earlier:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">implicit</span> <span class="k">def</span> <span class="nf">injectCoproductLeft</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]</span>, <span class="kt">X</span><span class="o">[</span><span class="k">_</span><span class="o">]]</span><span class="k">:</span> <span class="kt">Inject</span><span class="o">[</span><span class="kt">F</span>, <span class="kt">Coproduct</span><span class="o">[</span><span class="kt">F</span>, <span class="kt">X</span>, <span class="kt">?</span><span class="o">]]</span> <span class="k">=</span>
  <span class="k">new</span> <span class="nc">Inject</span><span class="o">[</span><span class="kt">F</span>, <span class="kt">Coproduct</span><span class="o">[</span><span class="kt">F</span>, <span class="kt">X</span>, <span class="kt">?</span><span class="o">]]</span> <span class="o">{</span>
    <span class="k">def</span> <span class="nf">inj</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">Coproduct</span><span class="o">[</span><span class="kt">F</span>, <span class="kt">X</span>, <span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="nv">Coproduct</span><span class="o">.</span><span class="py">leftc</span><span class="o">(</span><span class="n">fa</span><span class="o">)</span>
  <span class="o">}</span>
</code></pre></div></div>

<p>The above will work for any <code class="language-plaintext highlighter-rouge">X</code> and so the left-hand problem is solved.</p>

<h3 id="right-hand">Right Hand</h3>

<p>We could do the same with the right-hand side of the coproduct and end up with enough tools in our box to automatically (i.e. by implicit provision of <code class="language-plaintext highlighter-rouge">Inject</code> instances) handle simple two-way coproducts appropriately.
But we can do better.
If we wanted ‘three-way coproducts’ or more, it is possible to define them by nesting them:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Coproduct</span><span class="o">[</span><span class="kt">F1</span>, <span class="kt">Coproduct</span><span class="o">[</span><span class="kt">F2</span>, <span class="kt">F3</span>, <span class="kt">?</span><span class="o">]</span>, <span class="kt">?</span><span class="o">]</span> <span class="c1">// 3-way</span>
<span class="nc">Coproduct</span><span class="o">[</span><span class="kt">F1</span>, <span class="kt">Coproduct</span><span class="o">[</span><span class="kt">F2</span>, <span class="kt">Coproduct</span><span class="o">[</span><span class="kt">F3</span>, <span class="kt">F4</span>, <span class="kt">?</span><span class="o">]</span>, <span class="kt">?</span><span class="o">]</span>, <span class="kt">?</span><span class="o">]</span> <span class="c1">// 4-way</span>
<span class="c1">// ...</span>
</code></pre></div></div>

<p>And we can <em>still</em> derive automatically <code class="language-plaintext highlighter-rouge">Inject</code> instances that work with these extended coproducts.
As long as the ‘nested coproduct’ is in the right-hand position, at least.
This is because we define the <code class="language-plaintext highlighter-rouge">Inject</code> instance for the right-hand side like this:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">implicit</span> <span class="k">def</span> <span class="nf">injectCoproductRight</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]</span>, <span class="kt">R</span><span class="o">[</span><span class="k">_</span><span class="o">]</span>, <span class="kt">X</span><span class="o">[</span><span class="k">_</span><span class="o">]](</span><span class="k">implicit</span> <span class="n">I</span><span class="k">:</span> <span class="kt">Inject</span><span class="o">[</span><span class="kt">F</span>, <span class="kt">R</span><span class="o">])</span><span class="k">:</span> <span class="kt">Inject</span><span class="o">[</span><span class="kt">F</span>, <span class="kt">Coproduct</span><span class="o">[</span><span class="kt">X</span>, <span class="kt">R</span>, <span class="kt">?</span><span class="o">]]</span> <span class="k">=</span>
  <span class="k">new</span> <span class="nc">Inject</span><span class="o">[</span><span class="kt">F</span>, <span class="kt">Coproduct</span><span class="o">[</span><span class="kt">X</span>, <span class="kt">R</span>, <span class="kt">?</span><span class="o">]]</span> <span class="o">{</span>
    <span class="k">def</span> <span class="nf">inj</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">Coproduct</span><span class="o">[</span><span class="kt">X</span>, <span class="kt">R</span>, <span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="nv">Coproduct</span><span class="o">.</span><span class="py">rightc</span><span class="o">(</span><span class="nv">I</span><span class="o">.</span><span class="py">inj</span><span class="o">(</span><span class="n">fa</span><span class="o">))</span>
  <span class="o">}</span>
</code></pre></div></div>

<p>Note that, unlike the left-hand case earlier, we don’t try to match the case where <code class="language-plaintext highlighter-rouge">F</code> itself is in the right-hand position. Rather, we identify the right-hand as another type constructor (<code class="language-plaintext highlighter-rouge">R</code>), about which we know nothing, except that <em>we demand, as an implicit argument, proof that we are able to inject <code class="language-plaintext highlighter-rouge">F</code> into it</em>. Which we then use to do exactly that.
So, if this additional implicit <code class="language-plaintext highlighter-rouge">I: Inject[F, R]</code> can be found, we are done and the right-hand case also ties up. It boils down to how we get that proof, i.e. that additional <code class="language-plaintext highlighter-rouge">Inject[F, R]</code> instance we require.</p>

<ul>
  <li>Case 1:
<code class="language-plaintext highlighter-rouge">R</code> is another coproduct with <code class="language-plaintext highlighter-rouge">F</code> on its left-hand side. We know how to handle this case: we’ve written it earlier (<code class="language-plaintext highlighter-rouge">injectCoproductLeft</code>).</li>
  <li>Case 2:
<code class="language-plaintext highlighter-rouge">R</code> is another coproduct with <code class="language-plaintext highlighter-rouge">F</code> on its right-hand side. In this case <code class="language-plaintext highlighter-rouge">injectCoproductRight</code> will be called recursively again and we’ll be back at this point!</li>
  <li>Case 3:
<code class="language-plaintext highlighter-rouge">R</code> is actually <code class="language-plaintext highlighter-rouge">F</code> itself. in other words, the type that we were trying to inject is the same type as what’s in the right-hand side of the coproduct. In this case we’re looking for an <code class="language-plaintext highlighter-rouge">Inject[F, F]</code>, which will be trivial to write:
    <div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">implicit</span> <span class="k">def</span> <span class="nf">injectReflexive</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]]</span><span class="k">:</span> <span class="kt">Inject</span><span class="o">[</span><span class="kt">F</span>, <span class="kt">F</span><span class="o">]</span> <span class="k">=</span>
<span class="k">new</span> <span class="nc">Inject</span><span class="o">[</span><span class="kt">F</span>, <span class="kt">F</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">def</span> <span class="nf">inj</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="n">fa</span>
<span class="o">}</span>
</code></pre></div>    </div>
  </li>
  <li>And what if there is a Case 4, which is to say, <code class="language-plaintext highlighter-rouge">R</code> is something else entirely? Then the implicit resolution will fail, as is reasonable to expect, as we can’t put something into a coproduct that doesn’t have it as its options!</li>
</ul>

<p>With these three implicit instances of <code class="language-plaintext highlighter-rouge">Inject</code> (the left, right and reflexive) we are able to automatically derive mechanisms to inject any desired type into any coproduct that contains it.
Don’t worry though, all of these implicits are already in Cats and we won’t actually have to write them ourselves.</p>

<h3 id="finishing-up">Finishing up</h3>

<p>Back to our multiple DSLs.
We have seen how to lift a single type constructor to the <code class="language-plaintext highlighter-rouge">Free</code> monad:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">readData</span><span class="o">(</span><span class="n">port</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=</span> <span class="nv">Free</span><span class="o">.</span><span class="py">liftF</span><span class="o">[</span><span class="kt">Action</span>, <span class="kt">String</span><span class="o">](</span><span class="nc">ReadData</span><span class="o">(</span><span class="n">port</span><span class="o">))</span>
</code></pre></div></div>

<p>What if instead we had a coproduct <code class="language-plaintext highlighter-rouge">Cop[A]</code>, which is a coproduct of <code class="language-plaintext highlighter-rouge">Action</code> and other algebras?
We don’t need to know the exact structure of <code class="language-plaintext highlighter-rouge">Cop</code>. We can simply call:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">readData</span><span class="o">(</span><span class="n">port</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Free</span><span class="o">[</span><span class="kt">Cop</span>, <span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nv">Free</span><span class="o">.</span><span class="py">inject</span><span class="o">[</span><span class="kt">Action</span>, <span class="kt">Cop</span><span class="o">](</span><span class="nc">ReadData</span><span class="o">(</span><span class="n">port</span><span class="o">))</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">Free.inject[F, Cop]</code> is simply shorthand for:</p>

<ol>
  <li>implicitly resolving an instance of <code class="language-plaintext highlighter-rouge">Inject[F, Cop]</code>,</li>
  <li>using it to inject <code class="language-plaintext highlighter-rouge">F[A]</code> into <code class="language-plaintext highlighter-rouge">Cop[A]</code>, and finally</li>
  <li>lifting <code class="language-plaintext highlighter-rouge">Cop[A]</code> into the <code class="language-plaintext highlighter-rouge">Free</code> monad.</li>
</ol>

<p>So, let’s bring our mind back to those convenience methods we defined at the start, to lift those <code class="language-plaintext highlighter-rouge">Action</code>s into <code class="language-plaintext highlighter-rouge">Free</code>:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">object</span> <span class="nc">ActionFree</span> <span class="o">{</span>
  <span class="k">def</span> <span class="nf">readData</span><span class="o">(</span><span class="n">port</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Free</span><span class="o">[</span><span class="kt">Action</span>, <span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nv">Free</span><span class="o">.</span><span class="py">liftF</span><span class="o">(</span><span class="nc">ReadData</span><span class="o">(</span><span class="n">port</span><span class="o">))</span>
  <span class="k">def</span> <span class="nf">transformData</span><span class="o">(</span><span class="n">data</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Free</span><span class="o">[</span><span class="kt">Action</span>, <span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nv">Free</span><span class="o">.</span><span class="py">liftF</span><span class="o">(</span><span class="nc">TransformData</span><span class="o">(</span><span class="n">data</span><span class="o">))</span>
  <span class="k">def</span> <span class="nf">writeData</span><span class="o">(</span><span class="n">port</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">data</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Free</span><span class="o">[</span><span class="kt">Action</span>, <span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span> <span class="nv">Free</span><span class="o">.</span><span class="py">liftF</span><span class="o">(</span><span class="nc">WriteData</span><span class="o">(</span><span class="n">port</span><span class="o">,</span> <span class="n">data</span><span class="o">))</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Let’s generalise them with what we have learnt. We’ll no longer have a static object but a class with a type parameter:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ActionFree</span><span class="o">[</span><span class="kt">C</span><span class="o">[</span><span class="k">_</span><span class="o">]](</span><span class="k">implicit</span> <span class="n">inject</span><span class="k">:</span> <span class="kt">Inject</span><span class="o">[</span><span class="kt">Action</span>, <span class="kt">C</span><span class="o">])</span> <span class="o">{</span>
  <span class="k">def</span> <span class="nf">readData</span><span class="o">(</span><span class="n">port</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Free</span><span class="o">[</span><span class="kt">C</span>, <span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nv">Free</span><span class="o">.</span><span class="py">inject</span><span class="o">[</span><span class="kt">Action</span>, <span class="kt">C</span><span class="o">](</span><span class="nc">ReadData</span><span class="o">(</span><span class="n">port</span><span class="o">))</span>
  <span class="k">def</span> <span class="nf">transformData</span><span class="o">(</span><span class="n">data</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Free</span><span class="o">[</span><span class="kt">C</span>, <span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nv">Free</span><span class="o">.</span><span class="py">inject</span><span class="o">[</span><span class="kt">Action</span>, <span class="kt">C</span><span class="o">](</span><span class="nc">TransformData</span><span class="o">(</span><span class="n">data</span><span class="o">))</span>
  <span class="k">def</span> <span class="nf">writeData</span><span class="o">(</span><span class="n">port</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">data</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Free</span><span class="o">[</span><span class="kt">C</span>, <span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span> <span class="nv">Free</span><span class="o">.</span><span class="py">inject</span><span class="o">[</span><span class="kt">Action</span>, <span class="kt">C</span><span class="o">](</span><span class="nc">WriteData</span><span class="o">(</span><span class="n">port</span><span class="o">,</span> <span class="n">data</span><span class="o">))</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">C</code> type parameter is the coproduct definition we use, and we can change it easily if we need to.
We could swap the terms, from <code class="language-plaintext highlighter-rouge">Coproduct[Action, AdvancedAction, ?]</code> to <code class="language-plaintext highlighter-rouge">Coproduct[AdvancedAction, Action, ?]</code> or we could add more, like <code class="language-plaintext highlighter-rouge">Coproduct[Action, Coproduct[AdvancedAction, AdminAction, ?], ?]</code>, and the implicit resolution of <code class="language-plaintext highlighter-rouge">inject</code> would still find the correct <code class="language-plaintext highlighter-rouge">Inject</code> instance to deal with it.</p>

<h2 id="conclusion">Conclusion</h2>

<p>In this post we discussed the implementation of <code class="language-plaintext highlighter-rouge">Free</code> in Cats. We went into a lot of depth about the implementation of <code class="language-plaintext highlighter-rouge">Coproduct</code> and <code class="language-plaintext highlighter-rouge">Inject</code>, and their application to mixing free algebras. I found this detail useful when trying to understand <code class="language-plaintext highlighter-rouge">Free</code>. I hope you found it useful as well.</p>

<h2 id="references">References</h2>

<p>On <code class="language-plaintext highlighter-rouge">Free</code>:</p>
<ul>
  <li><a href="/blog/posts/2015/04/14/free-monads-are-simple.html">Free Monads Are Simple</a>, by Noel Welsh</li>
  <li><a href="http://perevillega.com/understanding-free-monads">Understanding Free Monads</a> by Pere Villega</li>
  <li><a href="https://blog.scalac.io/2016/06/02/overview-of-free-monad-in-cats.html">Overview of free monad in cats</a> by Krzysztof Wyczesany</li>
</ul>

<p>On injector classes:</p>
<ul>
  <li><a href="http://www.staff.science.uu.nl/~swier004/publications/2008-jfp.pdf">Data types à la carte</a> by Wouter Swierstra</li>
</ul>


        </article>

        <hr>

        
          <div class="row">
  <div class="col-sm-4 col-sm-offset-2">
    <h3 class="text-center">
      Like what you're reading?
    </h3>
    <p class="text-center">
      <a href="/blog/newsletters" class="btn btn-primary">
        Join our newsletter
        <span class="icon-uio-chevron-right "></span>
      </a>
    </p>
  </div>
</div>
        

        <hr>

        <h2 class="comments">Comments</h2>

<p>
  We encourage discussion of our blog posts on our <a href="https://gitter.im/underscoreio/scala">Gitter channel</a>.
  Please review our <a href="/terms#comments">Community Guidelines</a> before posting there.
  We encourage discussion in good faith, but do not allow combative, exclusionary, or harassing behaviour. 
  If you have any questions, <a href="/contact">contact us</a>!
</p>

      </section>
    </div>

    <div class="col-md-4">
      <aside class="blog-sidebar">
        <div id="mc_embed_signup" class="blog-sidebar-mailchimp panel panel-gray">
  <div class="panel-body">
    <h4>The Underscore Newsletter</h4>

    <p>Keep up to date! Subscribe to our newsletter for the latest Scala news.</p>

    <form method="post"
          action="http://underscoreconsulting.us3.list-manage.com/subscribe/post?u=a62dbb8a9c32f6c994dfd1111&amp;id=e9817b5369"
              id="mc-embedded-subscribe-form"
            name="mc-embedded-subscribe-form"
           class="validate"
          target="_blank"
      novalidate="">
      <fieldset>
        <div class="row">
          <div class="col-sm-12">
            <div class="form-group">
              <button class="btn btn-primary" id="mc-embedded-subscribe" type="submit" data-goal="click">Keep me posted</button>
            </div>
          </div>
        </div>
      </fieldset>
    </form>

    <p class="text-muted">
      <small>No spam. Unsubscribe at any time. We do not share personal details with third parties.</small>
    </p>

    <p class="text-muted">
      <small><a href="/blog/newsletters">Browse old newsletters to see what you'll get</a></small>
    </p>
  </div>
</div>
<div class="blog-sidebar-promos">
  <h4>Books from Underscore</h4>

  
  <div class="blog-sidebar-promo essential-scala"
     data-book-id="/books/essential-scala">
  <a class="book-title" href="/books/essential-scala">
    <span class="book-icon icon-uio-scala"></span>
    <span class="book-title-text">
      Essential Scala
    </span>

    <span class="pull-right">
      <span class="hidden-md">Read more</span>
      <span class="icon-uio-chevron-right "></span>
    </span>
  </a>
</div>


  
  <div class="blog-sidebar-promo scala-with-cats"
     data-book-id="/books/scala-with-cats">
  <a class="book-title" href="/books/scala-with-cats">
    <span class="book-icon icon-uio-cats"></span>
    <span class="book-title-text">
      Scala with Cats
    </span>

    <span class="pull-right">
      <span class="hidden-md">Read more</span>
      <span class="icon-uio-chevron-right "></span>
    </span>
  </a>
</div>


  
  <div class="blog-sidebar-promo essential-slick"
     data-book-id="/books/essential-slick">
  <a class="book-title" href="/books/essential-slick">
    <span class="book-icon icon-uio-scala"></span>
    <span class="book-title-text">
      Essential Slick
    </span>

    <span class="pull-right">
      <span class="hidden-md">Read more</span>
      <span class="icon-uio-chevron-right "></span>
    </span>
  </a>
</div>


  
  <div class="blog-sidebar-promo shapeless-guide"
     data-book-id="/books/shapeless-guide">
  <a class="book-title" href="/books/shapeless-guide">
    <span class="book-icon icon-uio-shapeless"></span>
    <span class="book-title-text">
      The Type Astronaut's Guide to Shapeless
    </span>

    <span class="pull-right">
      <span class="hidden-md">Read more</span>
      <span class="icon-uio-chevron-right "></span>
    </span>
  </a>
</div>

</div>

<aside class="blog-sidebar-archives">
  <h4>Archives</h4>

  <ul class="list-unstyled">
    
      
        <li class="heading">May 2020</li>
      

      <li><a href="/blog/posts/2020/05/27/scala-with-cats-2.html">Scala with Cats 2</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2020/05/14/porting-and-seq.html">Review Seq matching when porting to 2.13</a></li>
    
      
        
        
        
          <li class="heading">Dec 2019</li>
        
      

      <li><a href="/blog/posts/2019/12/23/talks-roundup.html">Our Talks from 2019</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2019/12/12/tut-to-mdoc.html">Tips for moving from tut to mdoc</a></li>
    
      
        
        
        
          <li class="heading">Jul 2019</li>
        
      

      <li><a href="/blog/posts/2019/07/04/introducing-inner-product.html">Introducing Inner Product</a></li>
    
      
        
        
        
          <li class="heading">Dec 2018</li>
        
      

      <li><a href="/blog/posts/2018/12/21/talks-roundup.html">Our Talks from 2018</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2018/12/12/bridges.html">Bridging Scala and the Front-End</a></li>
    
      
        
        
        
          <li class="heading">May 2018</li>
        
      

      <li><a href="/blog/posts/2018/05/17/modelling-js.html">Modelling JavaScript in Scala with Scala.js</a></li>
    
      
        
        
        
          <li class="heading">Mar 2018</li>
        
      

      <li><a href="/blog/posts/2018/03/20/fs2.html">Tips for working with FS2</a></li>
    
      
        
        
        
          <li class="heading">Dec 2017</li>
        
      

      <li><a href="/blog/posts/2017/12/14/scorex.html">A look at Scorex: a Scala blockchain framework</a></li>
    
      
        
        
        
          <li class="heading">Nov 2017</li>
        
      

      <li><a href="/blog/posts/2017/11/22/scala-with-cats.html">Announcing Scala with Cats</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2017/11/20/newsletter17.html">Newsletter 17: Season for Giving Edition</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2017/11/20/talks-from-team-underscore-at-scalax.html">Talks from Team Underscore at Scala Exchange</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2017/11/15/talks-to-watch-out-for-at-scalax.html">Talks to Watch Out For at Scala Exchange</a></li>
    
      
        
        
        
          <li class="heading">Sep 2017</li>
        
      

      <li><a href="/blog/posts/2017/09/05/review.html">Getting Into Other People's Code</a></li>
    
      
        
        
        
          <li class="heading">Jun 2017</li>
        
      

      <li><a href="/blog/posts/2017/06/02/uniting-church-and-state.html">Uniting Church and State: FP and OO Together</a></li>
    
      
        
        
        
          <li class="heading">May 2017</li>
        
      

      <li><a href="/blog/posts/2017/05/31/newsletter16.html">Newsletter 16: It's Book Time!</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2017/05/29/why-we-open-sourced-our-books.html">Why We Open Sourced our Books</a></li>
    
      
        
        
        
          <li class="heading">Apr 2017</li>
        
      

      <li><a href="/blog/posts/2017/04/11/type-tetris.html">Playing "Type Tetris"
</a></li>
    
      
        
        
        
          <li class="heading">Mar 2017</li>
        
      

      <li><a href="/blog/posts/2017/03/29/free-inject.html">The Free Monad with Multiple Algebras</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2017/03/07/refined-data-config-database.html">Refining your data from configuration to database</a></li>
    
      
        
        
        
          <li class="heading">Jan 2017</li>
        
      

      <li><a href="/blog/posts/2017/01/24/finch-functional-web-development.html">Finch: Functional Web Development</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2017/01/17/newsletter15.html">Newsletter 15: New Events in the New Year</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2017/01/17/agile-awards.html">Barclays Agile Awards 2016</a></li>
    
      
        
        
        
          <li class="heading">Dec 2016</li>
        
      

      <li><a href="/blog/posts/2016/12/16/newsletter14.html">Newsletter 14: Closing the Book on 2016</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2016/12/05/type-lambdas.html">Type lambdas and kind projector</a></li>
    
      
        
        
        
          <li class="heading">Nov 2016</li>
        
      

      <li><a href="/blog/posts/2016/11/24/value-discard.html">Value Discarding</a></li>
    
      
        
        
        
          <li class="heading">Oct 2016</li>
        
      

      <li><a href="/blog/posts/2016/10/11/twenty-two.html">Scala and 22</a></li>
    
      
        
        
        
          <li class="heading">Jul 2016</li>
        
      

      <li><a href="/blog/posts/2016/07/20/speaking-at-scalax.html">Giving a First Talk</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2016/07/20/new-speakers-at-scala-exchange-2016.html">How You Can Help Bring New Speakers and New Ideas to Scala eXchange 2016</a></li>
    
      
        
        
        
          <li class="heading">Jun 2016</li>
        
      

      <li><a href="/blog/posts/2016/06/27/opaque-transparent-interpreters.html">Opaque and Transparent Interpreters</a></li>
    
      
        
        
        
          <li class="heading">Apr 2016</li>
        
      

      <li><a href="/blog/posts/2016/04/21/probabilistic-programming.html">Probabilistic Programming in Scala</a></li>
    
      
        
        
        
          <li class="heading">Mar 2016</li>
        
      

      <li><a href="/blog/posts/2016/03/21/serverless-scale-summit.html">Scala.js is Important for Cloud Services</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2016/03/08/qcon.html">Types Working For You, Not Against You</a></li>
    
      
        
        
        
          <li class="heading">Feb 2016</li>
        
      

      <li><a href="/blog/posts/2016/02/02/advanced-scala-scalaz-to-cats.html">Advanced Scala Scalaz to Cats</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2016/02/01/aws-lambda.html">Scala and AWS Lambda Blueprints</a></li>
    
      
        
        
        
          <li class="heading">Jan 2016</li>
        
      

      <li><a href="/blog/posts/2016/01/19/typelevel-summits.html">Typelevel Summits</a></li>
    
      
        
        
        
          <li class="heading">Dec 2015</li>
        
      

      <li><a href="/blog/posts/2015/12/22/newsletter13.html">Newsletter 13: Christmas Loot Edition</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/12/21/scalax-slick-workshop.html">Video from the Slick Workshop at Scala Exchange 2015</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/12/21/scalax-interpreters-workshop.html">Slides and Code from the Interpreters Workshop at Scala Exchange 2015</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/12/18/tut.html">tut</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/12/18/scala-exchange-highlights.html">Highlights from Scala Exchange 2015</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/12/01/newsletter12.html">Newsletter 12: Scala Exchange</a></li>
    
      
        
        
        
          <li class="heading">Nov 2015</li>
        
      

      <li><a href="/blog/posts/2015/11/19/essential-slick-review-copies.html">Essential Slick Feature Complete and Review Copies Available</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/11/17/why-3x5-is-and-isnt-5x3.html">Why 3&times;5 is and isn't 5&times;3</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/11/09/sbt-commands.html">SBT Tricks</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/11/04/late-binding-and-overloading.html">Late Binding and Overloading in Scala</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/11/03/atom.html">Using the Atom Editor with Scala</a></li>
    
      
        
        
        
          <li class="heading">Oct 2015</li>
        
      

      <li><a href="/blog/posts/2015/10/14/reification.html">Reification, Kleislis, and Stream Libraries</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/10/01/newsletter11.html">Newsletter 11: Books and Boxes</a></li>
    
      
        
        
        
          <li class="heading">Sep 2015</li>
        
      

      <li><a href="/blog/posts/2015/09/16/book-update.html">Updates on the Underscore Books</a></li>
    
      
        
        
        
          <li class="heading">Aug 2015</li>
        
      

      <li><a href="/blog/posts/2015/08/28/essential-slick.html">Essential Slick Updates</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/08/23/slick-getresults.html">Using slickless with Plain SQL</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/08/08/slickless.html">Using shapeless HLists with Slick 3</a></li>
    
      
        
        
        
          <li class="heading">Jul 2015</li>
        
      

      <li><a href="/blog/posts/2015/07/24/diversity.html">You Can Increase Diversity at Scala eXchange</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/07/21/simple-isnt-easy.html">Simple Isn't Easy</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/07/14/upsert.html">Upsert in Slick 3</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/07/03/newsletter10.html">Newsletter 10: Conferences, Cats, and Robots from the Future</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/07/02/annihilators-in-scala.html">Annihilators in Scala: An Example of Type Class Design</a></li>
    
      
        
        
        
          <li class="heading">Jun 2015</li>
        
      

      <li><a href="/blog/posts/2015/06/25/keeping-scala-simple.html">Keeping Scala Simple</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/06/10/scalajs-scaladays.html">Towards Browser and Server Utopia with Scala.js</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/06/10/an-introduction-to-cats.html">An Introduction to Cats</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/06/05/new-speakers-at-scala-exchange-2015.html">New Speakers at Scala Exchange 2015</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/06/04/newsletter9.html">Newsletter 9: Scala Jobs, Slick, Sealed Traits, Strata, and Scala Days</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/06/04/more-on-sealed.html">More on Sealed Traits in Scala</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/06/02/everything-about-sealed.html">Everything You Ever Wanted to Know About Sealed Traits in Scala</a></li>
    
      
        
        
        
          <li class="heading">May 2015</li>
        
      

      <li><a href="/blog/posts/2015/05/28/typechecking-sql.html">Typechecking SQL in Slick and doobie</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/05/15/slick-enrichment.html">Slick Query Enrichment</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/05/14/strata-hadoop-world.html">Strata + Hadoop World London 2015 In Review</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/05/06/essential-slick.html">Introducing Essential Slick</a></li>
    
      
        
        
        
          <li class="heading">Apr 2015</li>
        
      

      <li><a href="/blog/posts/2015/04/30/newsletter8.html">Newsletter 8: Free Monads and Free Courses</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/04/28/monadic-io-laziness-makes-you-free.html">Monadic IO: Laziness Makes You Free</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/04/24/distributed-teams.html">Practices for Distributed Scala Teams</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/04/23/deriving-the-free-monad.html">Deriving the Free Monad</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/04/14/free-monads-are-simple.html">Free Monads Are Simple</a></li>
    
      
        
        
        
          <li class="heading">Mar 2015</li>
        
      

      <li><a href="/blog/posts/2015/03/13/rxlift.html">RxLift: Reactive Web Components with LiftWeb and RxScala</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/03/05/newsletter7.html">Newsletter 7: Error Handling and Two New Books</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/03/05/compositional-music-composition.html">Compositional Music Composition</a></li>
    
      
        
        
        
          <li class="heading">Feb 2015</li>
        
      

      <li><a href="/blog/posts/2015/02/25/creative-scala-released.html">Creative Scala: A New Introduction to Scala</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/02/23/designing-fail-fast-error-handling.html">Designing Fail-Fast Error Handling</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/02/13/error-handling-without-throwing-your-hands-up.html">Error Handling Without Throwing Your Hands Up</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/02/09/newsletter6.html">Newsletter 6: Training and Diversity Online and Worldwide</a></li>
    
      
        
        
        
          <li class="heading">Jan 2015</li>
        
      

      <li><a href="/blog/posts/2015/01/29/rethinking-online-training.html">Rethinking Online Training</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/01/29/diversity-in-training.html">Diversity in Training</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/01/16/lift-26-release.html">Highlights of the Lift Web Framework 2.6 Release</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/01/14/new-speakers-at-scala-exchange.html">Roundup of the New Speakers at Scala Exchange</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/01/05/codereview.html">Code Review at Scala eXchange</a></li>
    
      
        
        
        
          <li class="heading">Dec 2014</li>
        
      

      <li><a href="/blog/posts/2014/12/16/essential-scala-and-play-books-available-for-early-access.html">Essential Scala and Play Books Available for Early Access</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/12/05/newsletter5.html">Newsletter 5: Xmas Reading</a></li>
    
      
        
        
        
          <li class="heading">Oct 2014</li>
        
      

      <li><a href="/blog/posts/2014/10/20/newsletter4.html">Newsletter 4</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/10/20/essential-esential-scala-at-hack-the-tower.html">Essential Essential Scala at Hack the Tower</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/10/17/new-speakers-at-scala-exchange.html">New Speakers at Scala Exchange</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/10/02/learn-shapeless-find-500-dollars.html">Learn Shapeless, Find $500</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/10/01/intro-functional-finance.html">Introducing Functional Finance</a></li>
    
      
        
        
        
          <li class="heading">Sep 2014</li>
        
      

      <li><a href="/blog/posts/2014/09/16/response-to-the-typelevel-fork.html">Our Response to the Typelevel fork of Scala</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/09/03/enumerations.html">Scala Enumerations</a></li>
    
      
        
        
        
          <li class="heading">Aug 2014</li>
        
      

      <li><a href="/blog/posts/2014/08/28/tools-to-guide-code-quality.html">Tools to guide code quality</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/08/17/angularjs-vs-react.html">AngularJs vs React</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/08/07/newsletter3.html">Newsletter 3</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/08/07/scala-exchange-nsap-last-call.html">Scala Exchange New Speaker Programme Closing Soon</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/08/05/code-reviews-dont-produce-quality-code.html">Code Reviews Don't Produce Quality Code</a></li>
    
      
        
        
        
          <li class="heading">Jul 2014</li>
        
      

      <li><a href="/blog/posts/2014/07/27/readerwriterstate.html">A Small (Real) Example of the Reader and Writer Monads</a></li>
    
      
        
        
        
          <li class="heading">Jun 2014</li>
        
      

      <li><a href="/blog/posts/2014/06/30/underscores-new-speaker-program.html">Underscore's New Speaker Program for Scala Exchange</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/06/24/scala-days-2014-the-lowdown.html">Scala Days 2014: The Low-down</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/06/21/announcing-underscoreio.html">Announcing underscore.io</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/06/05/lambda.html">Java 8 Crib Sheet for Scala Developers</a></li>
    
      
        
        
        
          <li class="heading">May 2014</li>
        
      

      <li><a href="/blog/posts/2014/05/02/hiring-scala-developers.html">Hiring Scala Developers</a></li>
    
      
        
        
        
          <li class="heading">Apr 2014</li>
        
      

      <li><a href="/blog/posts/2014/04/30/newsletter2.html">Newsletter 2</a></li>
    
      
        
        
        
          <li class="heading">Mar 2014</li>
        
      

      <li><a href="/blog/posts/2014/03/18/newsletter1.html">Newsletter 1</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/03/10/teaching-scala.html">Teaching Scala</a></li>
    
      
        
        
        
          <li class="heading">Jan 2014</li>
        
      

      <li><a href="/blog/posts/2014/01/29/unboxed-tagged-angst.html">Unboxed Tagged Angst</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/01/06/crdt.html">Collaborative Text Editing</a></li>
    
      
        
        
        
          <li class="heading">Dec 2013</li>
        
      

      <li><a href="/blog/posts/2013/12/20/scalaz-monad-transformers.html">Scalaz Monad Transformers</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2013/12/20/crdts-for-fun-and-eventual-profit.html">CRDTs for fun and eventual profit</a></li>
    
      
        
        
        
          <li class="heading">Oct 2013</li>
        
      

      <li><a href="/blog/posts/2013/10/01/functional-media-roundup-quality-counts.html">Functional Media Roundup: Quality Counts</a></li>
    
      
        
        
        
          <li class="heading">Aug 2013</li>
        
      

      <li><a href="/blog/posts/2013/08/01/lift.html">Lift Cookbook</a></li>
    
      
        
        
        
          <li class="heading">Jul 2013</li>
        
      

      <li><a href="/blog/posts/2013/07/09/media-panel.html">Functional Programming in Media and Publishing</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2013/07/03/cloudbees.html">CloudBees Service Partner</a></li>
    
      
        
        
        
          <li class="heading">Mar 2013</li>
        
      

      <li><a href="/blog/posts/2013/03/13/streaming-algorithms-preregister.html">Pre-register for Streaming Algorithms Course</a></li>
    
      
        
        
        
          <li class="heading">Oct 2012</li>
        
      

      <li><a href="/blog/posts/2012/10/16/a-tribute-to-phil-bagwell.html">A Tribute to Phil Bagwell</a></li>
    
      
        
        
        
          <li class="heading">Aug 2012</li>
        
      

      <li><a href="/blog/posts/2012/08/01/developer-price.html">Misconceptions about Scala Developer Rates</a></li>
    
      
        
        
        
          <li class="heading">Jul 2012</li>
        
      

      <li><a href="/blog/posts/2012/07/09/another-typeclass.html">Another Small Example of the Type Class Pattern</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2012/07/06/icml-review.html">Review of COLT and ICML</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2012/07/02/kleisli-arrows.html">A Small Example of Kleisli Arrows</a></li>
    
      
        
        
        
          <li class="heading">Jun 2012</li>
        
      

      <li><a href="/blog/posts/2012/06/16/phantom-types.html">A Small Example of Phantom Types</a></li>
    
      
        
        
        
          <li class="heading">May 2012</li>
        
      

      <li><a href="/blog/posts/2012/05/03/typeclasses.html">A Small Example of the Typeclass Pattern</a></li>
    
  </ul>
</aside>

      </aside>
    </div>
  </div>
</section>

<footer>
  <div class="container">
    <div class="text-center">
      <img src="/images/common/footer-brand.png" class="footer-brand" alt="Underscore">
    </div>

    <div class="row sitemap">
      <div class="col-sm-6 col-md-4">
        <h5><a href="/">Underscore</a></h5>
        <ul class="list-unstyled">
          <li><a href="/">Home</a></li>
          <li><a href="/consulting">Our Services</a></li>
          <li><a href="/privacy">Privacy Policy</a></li>
          <li class="currency-select">
            Currency:
            <a href="javascript:void(0)" class="currency-select-usd">USD</a>,
            <a href="javascript:void(0)" class="currency-select-gbp">GBP</a>,
            <a href="javascript:void(0)" class="currency-select-eur">EUR</a>
          </li>
        </ul>
      </div>

      <div class="col-sm-6 col-md-4">
        <h5><a href="/training">Courses and Training</a></h5>
        <ul class="list-unstyled">
          <li><a href="/training/bookings">Book a Course</a></li>
          <li><a href="/training">Course Directory</a></li>
          <li><a href="/training/courses/essential-scala">Essential Scala</a></li>
          <li><a href="/training/courses/advanced-scala">Advanced Scala with Cats</a></li>
        </ul>
      </div>

      <div class="col-sm-6 col-md-4">
        <h5><a href="/contact">Contact</a></h5>
        <ul class="list-unstyled">
          <li><a href="/contact">
            <span class="icon-uio-envelope "></span>
            hello@underscore.io
          </a></li>
          <li><a href="http://twitter.com/underscoreio">
            <span class="icon-uio-twitter "></span>
            @underscoreio
          </a></li>
          <li><a href="/blog/newsletters">
            <span class="icon-uio-public "></span>
            The Underscore Newsletter
          </a></li>
        </ul>
      </div>
    </div>

    <p class="copyright text-center">
      Copyright 2011&ndash;22.
      <br class="visible-xs">
      All rights reserved. <a href="/terms">Terms of use</a>
    </p>
  </div>
</footer>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-29444727-2', 'underscore.io');
      ga('send', 'pageview');
    </script>
  </body>
</html>
