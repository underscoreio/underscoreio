<!DOCTYPE html>
<html lang="en" id="/blog/posts/2015/07/14/upsert" class="">
  
  
  <head>
    <title>Upsert in Slick 3 - Underscore</title>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link type="text/css" rel="stylesheet" href="/assets/screen-9132d4f189ef656eb3d1e8defedf7c83e32e9240d9a3af3d804d36f850e43dd5.css">
    <link type="text/css" rel="stylesheet" href="/assets/print-dd04f6182ddcf193d2ac9f59bdbdbb366e01738f8a32086ffb82c7be2f9e1eb8.css" media="print">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@underscoreio">
    
      <meta name="twitter:title" content="Upsert in Slick 3">
    
    
      <meta name="twitter:description" content="An upsert means inserting a row into a database if it doesn’t already exist,
or updating the row if it does exist. The Slick database library knows how to do upserts.
This posts takes a look at the built-in support,
and gives an example of what you can do if you need to roll your own upsert logic.

This is part of a series on Slick, for material in or being added to Essential Slick.

">
    
    
      <meta name="twitter:image" content="http://underscore.io/images/twitter-card-icon.png">
    

    <link rel="shortcut icon" href="/images/favicon-64.png">
    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
    <link rel="alternate" type="application/rss+xml" title="RSS" href="/blog/feed.xml">

    <link rel="canonical" href="http://underscore.io/blog/posts/2015/07/14/upsert.html">

    <script type="text/javascript" src="/assets/site-5ab8e41df06f32ccfbf4c40fdf2d7fc81c360b991aa5c153ed01fd0714c019d4.js"></script>
  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/"><span class="icon-uio-underscore "></span></a>
    </div>

    <div class="navbar-collapse">
      <ul class="nav navbar-nav navbar-right visible-md visible-lg">
        <li class="divider"></li>
        <li class="social"><a href="http://twitter.com/underscoreio"><span class="icon-uio-twitter "></span><span class="sr-only">Twitter</span></a></li>
        <li class="social"><a href="/contact"><span class="icon-uio-envelope "></span><span class="sr-only">Email</span></a></li>
      </ul>

      <ul class="nav navbar-nav navbar-right">
        <li class="visible-xs "><a href="/">Home</a></li>
        <li class=""><a href="/development">Development</a></li>
        <li class=""><a href="/consulting">Consulting</a></li>
        <li class=""><a href="/training">Training</a></li>
        <!-- li class=""><a href="/books">Books</a></li -->
        <li class=""><a href="/company">Company</a></li>
      </ul>
    </div>
  </div>
</nav>


<div class="hero">
  <div class="overlay-gem-left-white hero-overlay-soft"></div>
  <div class="overlay-gem-right-white hero-overlay-soft"></div>
  <div class="overlay-arrow-white-inverse"></div>

  <nav class="navbar navbar-inverse" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/"><span class="icon-uio-underscore "></span></a>
    </div>

    <div class="navbar-collapse">
      <ul class="nav navbar-nav navbar-right visible-md visible-lg">
        <li class="divider"></li>
        <li class="social"><a href="http://twitter.com/underscoreio"><span class="icon-uio-twitter "></span><span class="sr-only">Twitter</span></a></li>
        <li class="social"><a href="/contact"><span class="icon-uio-envelope "></span><span class="sr-only">Email</span></a></li>
      </ul>

      <ul class="nav navbar-nav navbar-right">
        <li class="visible-xs "><a href="/">Home</a></li>
        <li class=""><a href="/development">Development</a></li>
        <li class=""><a href="/consulting">Consulting</a></li>
        <li class=""><a href="/training">Training</a></li>
        <!-- li class=""><a href="/books">Books</a></li -->
        <li class=""><a href="/company">Company</a></li>
      </ul>
    </div>
  </div>
</nav>


  <header class="hero-text">
    <div class="container">
      
        <h1>
          <a class="back-link" href="/blog">
            Blog
            <span class="icon-uio-back "></span>
          </a>
        </h1>
      

      
    </div>
  </header>
</div>


<section class="container">
  <div class="row">
    <div class="col-md-8">
      <section class="blog-post" data-post-url="/blog/posts/2015/07/14/upsert.html">
        <h2 class="blog-post-title">Upsert in Slick 3</h2>

        <dl class="blog-post-meta">
  <dt class="blog-post-date">Posted</dt>
  <dd class="blog-post-date">
    <span class="day">14</span>
    <span class="month">Jul</span>
    <span class="year">2015</span>
  </dd>
  <dt class="blog-post-author">by</dt>
  <dd class="blog-post-author">
    Richard Dallaway
  </dd>
  
</dl>


        <article class="blog-post-content">
          <p>An <em>upsert</em> means inserting a row into a database if it doesn’t already exist,
or updating the row if it does exist. The <a href="http://slick.typesafe.com/">Slick</a> database library knows how to do upserts.
This posts takes a look at the built-in support,
and gives an example of what you can do if you need to roll your own upsert logic.</p>

<p><em>This is part of a series on Slick, for material in or being added to <a href="http://underscore.io/training/courses/essential-slick/">Essential Slick</a></em>.</p>

<!-- break -->

<h2 id="built-in-support">Built in Support</h2>

<p>In Slick an upsert is provided by the method <code class="language-plaintext highlighter-rouge">insertOrUpdate</code>. If you have a table and a representation of a row you can <code class="language-plaintext highlighter-rouge">insertOrUpdate</code> that row. Very convenient.</p>

<p>This means two things:</p>

<ul>
  <li>Slick will automatically decide what it needs to do for you (<code class="language-plaintext highlighter-rouge">INSERT</code> or <code class="language-plaintext highlighter-rouge">UPDATE</code> or something else).  I’m being vague here, because “what it needs to do” could well vary depending on the database product you are using.</li>
  <li>Slick needs a way to match the value you have to some row in the database. The usual way to do that is with a primary key (composite or otherwise).</li>
</ul>

<p>An example will make this clearer. Let’s say we’re running a movie reviews database.  We have film titles with a rating.
In Slick we might model rows with a <code class="language-plaintext highlighter-rouge">Review</code> case class for the <code class="language-plaintext highlighter-rouge">ReviewTable</code>:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">Review</span><span class="o">(</span><span class="n">title</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">rating</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">id</span><span class="k">:</span> <span class="kt">Long</span> <span class="o">=</span> <span class="mi">0L</span><span class="o">)</span>

<span class="c1">// Hello to Jason Isaacs</span>
<span class="k">final</span> <span class="k">class</span> <span class="nc">ReviewTable</span><span class="o">(</span><span class="n">tag</span><span class="k">:</span> <span class="kt">Tag</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Table</span><span class="o">[</span><span class="kt">Review</span><span class="o">](</span><span class="n">tag</span><span class="o">,</span> <span class="s">"review"</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">def</span> <span class="nf">id</span>      <span class="k">=</span> <span class="n">column</span><span class="o">[</span><span class="kt">Long</span><span class="o">](</span><span class="s">"id"</span><span class="o">,</span> <span class="nv">O</span><span class="o">.</span><span class="py">PrimaryKey</span><span class="o">,</span> <span class="nv">O</span><span class="o">.</span><span class="py">AutoInc</span><span class="o">)</span>
  <span class="k">def</span> <span class="nf">title</span>   <span class="k">=</span> <span class="n">column</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="s">"title"</span><span class="o">)</span>
  <span class="k">def</span> <span class="nf">rating</span>  <span class="k">=</span> <span class="n">column</span><span class="o">[</span><span class="kt">Int</span><span class="o">](</span><span class="s">"rating"</span><span class="o">)</span>
  <span class="k">def</span> <span class="nf">*</span> <span class="k">=</span> <span class="o">(</span><span class="n">title</span><span class="o">,</span> <span class="n">rating</span><span class="o">,</span> <span class="n">id</span><span class="o">)</span> <span class="o">&lt;&gt;</span> <span class="o">(</span><span class="nv">Review</span><span class="o">.</span><span class="py">tupled</span><span class="o">,</span> <span class="nv">Review</span><span class="o">.</span><span class="py">unapply</span><span class="o">)</span>
<span class="o">}</span>

<span class="k">val</span> <span class="nv">reviews</span> <span class="k">=</span> <span class="nc">TableQuery</span><span class="o">[</span><span class="kt">ReviewTable</span><span class="o">]</span>
</code></pre></div></div>

<p>We can conjure up some reviews, and construct a program that will create the database, populate it, and give us back the content:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="nv">testData</span> <span class="k">=</span> <span class="nc">Seq</span><span class="o">(</span>
  <span class="nc">Review</span><span class="o">(</span><span class="s">"Godzilla"</span><span class="o">,</span> <span class="mi">8</span><span class="o">),</span>
  <span class="nc">Review</span><span class="o">(</span><span class="s">"Godzilla Raids Again"</span><span class="o">,</span> <span class="mi">6</span><span class="o">),</span>
  <span class="nc">Review</span><span class="o">(</span><span class="s">"King Kong vs. Godzilla"</span><span class="o">,</span> <span class="mi">5</span><span class="o">)</span>
<span class="o">)</span>

<span class="k">val</span> <span class="nv">action</span> <span class="k">=</span> <span class="k">for</span> <span class="o">{</span>
  <span class="k">_</span>     <span class="k">&lt;-</span> <span class="nv">reviews</span><span class="o">.</span><span class="py">schema</span><span class="o">.</span><span class="py">create</span>
  <span class="k">_</span>     <span class="k">&lt;-</span> <span class="n">reviews</span> <span class="o">++=</span> <span class="n">testData</span>
  <span class="n">films</span> <span class="k">&lt;-</span> <span class="nv">reviews</span><span class="o">.</span><span class="py">result</span>
<span class="o">}</span> <span class="k">yield</span> <span class="n">films</span>
</code></pre></div></div>

<p>If you’re not familiar with Slick 3, you don’t need to worry about the details above too much.
The key point here is that Slick works by running an <em>action</em> (such as <code class="language-plaintext highlighter-rouge">DBIO[T]</code>) via an interpreter.
The result will be a <code class="language-plaintext highlighter-rouge">Future[T]</code>.</p>

<p>Let’s run the above:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="nv">db</span> <span class="k">=</span> <span class="o">???</span> <span class="c1">// assume we have a database set up</span>
<span class="k">val</span> <span class="nv">future</span> <span class="k">=</span> <span class="nv">db</span><span class="o">.</span><span class="py">run</span><span class="o">(</span><span class="n">action</span><span class="o">).</span><span class="py">map</span> <span class="o">{</span> <span class="k">_</span> <span class="n">foreach</span> <span class="n">println</span> <span class="o">}</span>
<span class="nv">Await</span><span class="o">.</span><span class="py">result</span><span class="o">(</span><span class="n">future</span><span class="o">,</span> <span class="mi">2</span> <span class="n">seconds</span><span class="o">)</span>
<span class="c1">// Output:</span>
<span class="c1">// Review(Godzilla,8,1)</span>
<span class="c1">// Review(Godzilla Raids Again,6,2)</span>
<span class="c1">// Review(King Kong vs. Godzilla,5,3)  </span>
</code></pre></div></div>

<p>Because we’re selecting all film reviews, we end up with a <code class="language-plaintext highlighter-rouge">Future[Seq[Review]]</code>. For the rest of this post we are dealing with inserting and updating. By default we’ll get back a count of affected rows. This means the results we will work with are going to be <code class="language-plaintext highlighter-rouge">Future[Int]</code>.</p>

<p>So I want to post a new review. Maybe I’ll have changed my mind about a rating. Or maybe I’m reviewing a new film. What’s the code look like?</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="nv">review</span><span class="k">:</span> <span class="kt">Review</span> <span class="o">=</span> <span class="o">???</span> <span class="c1">// We have a review from somewhere</span>
<span class="k">val</span> <span class="nv">upsert</span><span class="k">:</span> <span class="kt">DBIO</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nv">reviews</span><span class="o">.</span><span class="py">insertOrUpdate</span><span class="o">(</span><span class="n">review</span><span class="o">)</span>
</code></pre></div></div>

<p>It doesn’t matter if <code class="language-plaintext highlighter-rouge">review</code> is a new instance only in memory, or one we retrieved from the database earlier. Slick will <code class="language-plaintext highlighter-rouge">INSERT</code> or <code class="language-plaintext highlighter-rouge">UPDATE</code> for us. When we execute the <code class="language-plaintext highlighter-rouge">upsert</code> action against H2, this sequence of SQL is executed if <code class="language-plaintext highlighter-rouge">review</code> already exists…</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="mi">1</span> <span class="k">from</span> <span class="nv">"review"</span> <span class="k">where</span> <span class="nv">"id"</span><span class="o">=?</span>
<span class="k">update</span> <span class="nv">"review"</span> <span class="k">set</span> <span class="nv">"title"</span><span class="o">=?</span><span class="p">,</span><span class="nv">"rating"</span><span class="o">=?</span> <span class="k">where</span> <span class="nv">"id"</span><span class="o">=?</span>
</code></pre></div></div>

<p>…or this SQL if it’s a new row:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="mi">1</span> <span class="k">from</span> <span class="nv">"review"</span> <span class="k">where</span> <span class="nv">"id"</span><span class="o">=?</span>
<span class="k">insert</span> <span class="k">into</span> <span class="nv">"review"</span> <span class="p">(</span><span class="nv">"title"</span><span class="p">,</span><span class="nv">"rating"</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">)</span>
</code></pre></div></div>

<p>Notice that Slick is using the primary key, <code class="language-plaintext highlighter-rouge">id</code>, to check and update the row.</p>

<p>A peculiarity of H2 with Slick is that if a row contains an auto incrementing key, as it does in this case, the upsert is simulated via the select and insert pair we’ve just seen. Without the <code class="language-plaintext highlighter-rouge">O.AutoInc</code> option for the table, the SQL for both cases becomes a <a href="https://en.wikipedia.org/wiki/Merge_%28SQL%29">merge</a>:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">merge</span> <span class="k">into</span> <span class="nv">"review"</span> <span class="p">(</span><span class="nv">"title"</span><span class="p">,</span><span class="nv">"rating"</span><span class="p">,</span><span class="nv">"id"</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">,</span><span class="o">?</span><span class="p">)</span>
</code></pre></div></div>

<p>That’s reasonably straight-forward. The right effect occurs in the database, and you get back a count of rows changed.</p>

<p>Sometimes you want the row back, not the count. Slick supports that via <code class="language-plaintext highlighter-rouge">returning</code>.
We discuss <code class="language-plaintext highlighter-rouge">returning</code> in Chapter 2 of <a href="http://underscore.io/training/courses/essential-slick/">Essential Slick</a>, but the pattern is:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span><span class="n">reviews</span> <span class="n">returning</span> <span class="n">reviews</span><span class="o">).</span><span class="py">insertOrUpdate</span><span class="o">(</span><span class="n">row</span><span class="o">)</span>
</code></pre></div></div>

<p>Not all database products support that.</p>

<h2 id="rolling-our-own-update">Rolling Our Own Update</h2>

<p>By included <code class="language-plaintext highlighter-rouge">insertOrUpdate</code> I’m guessing the Slick team have covered a large percentage of use cases for upsert. But if you want to do something different, how can you get the logic you need mixed in with database actions?</p>

<p>Let’s look at a slight variation of our film reviews database:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">Review</span><span class="o">(</span><span class="n">critic</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">title</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">rating</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>

<span class="k">final</span> <span class="k">class</span> <span class="nc">ReviewTable</span><span class="o">(</span><span class="n">tag</span><span class="k">:</span> <span class="kt">Tag</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Table</span><span class="o">[</span><span class="kt">Review</span><span class="o">](</span><span class="n">tag</span><span class="o">,</span> <span class="s">"review"</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">def</span> <span class="nf">critic</span> <span class="k">=</span> <span class="n">column</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="s">"critic_name"</span><span class="o">)</span>
  <span class="k">def</span> <span class="nf">title</span>  <span class="k">=</span> <span class="n">column</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="s">"title"</span><span class="o">)</span>
  <span class="k">def</span> <span class="nf">rating</span> <span class="k">=</span> <span class="n">column</span><span class="o">[</span><span class="kt">Int</span><span class="o">](</span><span class="s">"rating"</span><span class="o">)</span>
  <span class="k">def</span> <span class="nf">*</span> <span class="k">=</span> <span class="o">(</span><span class="n">critic</span><span class="o">,</span> <span class="n">title</span><span class="o">,</span> <span class="n">rating</span><span class="o">)</span> <span class="o">&lt;&gt;</span> <span class="o">(</span><span class="nv">Review</span><span class="o">.</span><span class="py">tupled</span><span class="o">,</span> <span class="nv">Review</span><span class="o">.</span><span class="py">unapply</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>

<p>We are going to have one rating from a critic for each title.</p>

<p>We’re not using a primary key here. We’re going to use this fact to exercise custom logic over what we do when posting a review.
(And it is just an illustration: you could, and probably should, use a composite key here. I’ve included an example of that in the <a href="https://github.com/d6y/slick-upsert">source code</a> that goes with this post.)</p>

<p>Without a key <code class="language-plaintext highlighter-rouge">insertOrUpdate</code> won’t work for us. We need to try something else.</p>

<p>Let’s assume we’re mostly making edits, and an update to a rating will probably succeed. If it doesn’t, we’ll try an insert. We need something like this:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">postReview</span><span class="o">(</span><span class="n">critic</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">title</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">rating</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">DBIO</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
  <span class="k">for</span> <span class="o">{</span>
    <span class="n">rowsAffected</span> <span class="k">&lt;-</span> <span class="n">reviews</span><span class="o">.</span>
                     <span class="nf">filter</span><span class="o">(</span><span class="n">r</span> <span class="k">=&gt;</span> <span class="nv">r</span><span class="o">.</span><span class="py">critic</span> <span class="o">===</span> <span class="n">critic</span> <span class="o">&amp;&amp;</span> <span class="nv">r</span><span class="o">.</span><span class="py">title</span> <span class="o">===</span> <span class="n">title</span><span class="o">).</span>
                     <span class="nf">map</span><span class="o">(</span><span class="nv">_</span><span class="o">.</span><span class="py">rating</span><span class="o">).</span>
                     <span class="nf">update</span><span class="o">(</span><span class="n">rating</span><span class="o">)</span>
    <span class="o">???</span>
    <span class="o">}</span>
  <span class="o">}</span> <span class="k">yield</span> <span class="o">???</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The intention of this code (when we finish it) is take the name of a critic, a film title, and a rating, and either insert a new row, or update an existing row. It returns a count of the rows affected, as a <code class="language-plaintext highlighter-rouge">DBIO[Int]</code>. This action is what we will run later.</p>

<p>We start with a query for existing reviews by this critic and title. This is a <code class="language-plaintext highlighter-rouge">DBIO[Int]</code> because it is an <code class="language-plaintext highlighter-rouge">update</code> of the <code class="language-plaintext highlighter-rouge">rating</code>. This will give us the rows affected by the update.</p>

<p>The logic we now want is:</p>

<ul>
  <li>if there are no rows affected, we need to insert a new review</li>
  <li>if there was one row affected, we’re done!</li>
  <li>otherwise, something really bad has happened and we have multiple reviews for a film by the same critic. This cannot be allowed to stand.</li>
</ul>

<p>We’re going to be able to achieve this because of a key feature of Slick 3: <code class="language-plaintext highlighter-rouge">DBIO</code> actions compose. If you’re approaching this thinking “how can I get the count out of the <code class="language-plaintext highlighter-rouge">DBIO</code>”, don’t.  Instead, think about what you can do to combine <code class="language-plaintext highlighter-rouge">DBIO</code>s together.</p>

<p>What we need to complete <code class="language-plaintext highlighter-rouge">postReview</code> is another <code class="language-plaintext highlighter-rouge">DBIO</code>. There are several ways we can get one. Calling <code class="language-plaintext highlighter-rouge">result</code> on a query is one way, but there are also standard ways to construct a <code class="language-plaintext highlighter-rouge">DBIO</code> for success and failure cases.  We can use them to complete the code:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">postReview</span><span class="o">(</span><span class="n">critic</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">title</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">rating</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>
              <span class="o">(</span><span class="k">implicit</span> <span class="n">ec</span><span class="k">:</span> <span class="kt">ExecutionContext</span><span class="o">)</span><span class="k">:</span> <span class="kt">DBIO</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
  <span class="k">for</span> <span class="o">{</span>
    <span class="n">rowsAffected</span> <span class="k">&lt;-</span> <span class="nv">reviews</span><span class="o">.</span><span class="py">filter</span><span class="o">(</span><span class="n">r</span> <span class="k">=&gt;</span> <span class="nv">r</span><span class="o">.</span><span class="py">critic</span> <span class="o">===</span> <span class="n">critic</span> <span class="o">&amp;&amp;</span> <span class="nv">r</span><span class="o">.</span><span class="py">title</span> <span class="o">===</span> <span class="n">title</span><span class="o">).</span>
                    <span class="nf">map</span><span class="o">(</span><span class="nv">_</span><span class="o">.</span><span class="py">rating</span><span class="o">).</span><span class="py">update</span><span class="o">(</span><span class="n">rating</span><span class="o">)</span>
    <span class="n">result</span> <span class="k">&lt;-</span> <span class="n">rowsAffected</span> <span class="k">match</span> <span class="o">{</span>
      <span class="k">case</span> <span class="mi">0</span> <span class="k">=&gt;</span> <span class="n">reviews</span> <span class="o">+=</span> <span class="nc">Review</span><span class="o">(</span><span class="n">critic</span><span class="o">,</span> <span class="n">title</span><span class="o">,</span> <span class="n">rating</span><span class="o">)</span>
      <span class="k">case</span> <span class="mi">1</span> <span class="k">=&gt;</span> <span class="nv">DBIO</span><span class="o">.</span><span class="py">successful</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
      <span class="k">case</span> <span class="n">n</span> <span class="k">=&gt;</span> <span class="nv">DBIO</span><span class="o">.</span><span class="py">failed</span><span class="o">(</span><span class="k">new</span> <span class="nc">RuntimeException</span><span class="o">(</span>
                <span class="n">s</span><span class="s">"Expected 0 or 1 change, not $n for $critic @ $title"</span><span class="o">))</span>
    <span class="o">}</span>
  <span class="o">}</span> <span class="k">yield</span> <span class="n">result</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Let’s walk down the body of this method:</p>

<ul>
  <li>
    <p>We’re trying to update a review. The <em>generator</em> (to the right of the <code class="language-plaintext highlighter-rouge">&lt;-</code>) is a <code class="language-plaintext highlighter-rouge">DBIO[Int]</code></p>
  </li>
  <li>
    <p>Next we use the <code class="language-plaintext highlighter-rouge">rowsAffected</code> to produce another <code class="language-plaintext highlighter-rouge">DBIO[Int]</code>:</p>
    <ul>
      <li><code class="language-plaintext highlighter-rouge">reviews += ...</code> inserts new row, and is a <code class="language-plaintext highlighter-rouge">DBIO[Int]</code></li>
      <li><code class="language-plaintext highlighter-rouge">DBIO.successful(1)</code> produces a <code class="language-plaintext highlighter-rouge">DBIO[Int]</code> for a constant value</li>
      <li><code class="language-plaintext highlighter-rouge">DBIO.failed</code> produces a <code class="language-plaintext highlighter-rouge">DBIO[Nothing]</code> for an exception, signalling failure.</li>
    </ul>
  </li>
</ul>

<p>As an exercise, you can de-sugar that for comprehension into <code class="language-plaintext highlighter-rouge">flatMap</code> and <code class="language-plaintext highlighter-rouge">map</code> to see how the <code class="language-plaintext highlighter-rouge">DBIO</code>s combine.  The main thing to notice, though, is that we can produce <code class="language-plaintext highlighter-rouge">DBIO[T]</code> for the arbitrary logic we need for our application.</p>

<p>Finally, notice that because we’re mixing database queries and user logic in a for comprehension, we need to also have an <code class="language-plaintext highlighter-rouge">ExecutionContext</code> in scope. Our logic will run on the context we supply to the method. Slick will sensibly release a session for the duration of our custom logic, unless it is <em><a href="http://slick.typesafe.com/doc/3.0.0/dbio.html#transactions-and-pinned-sessions">pinned</a></em>.</p>

<h2 id="get-or-create">Get or Create</h2>

<p>You should be able to see how this kind of code can deal with “fetch the row or create one”. Let’s add that into the mix for <code class="language-plaintext highlighter-rouge">postReview</code>, forgetting about critics to keep the example shorter:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">postReview</span><span class="o">(</span><span class="n">title</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">rating</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">DBIO</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="k">for</span> <span class="o">{</span>
  <span class="n">existing</span> <span class="k">&lt;-</span> <span class="nv">reviews</span><span class="o">.</span><span class="py">filter</span><span class="o">(</span><span class="nv">_</span><span class="o">.</span><span class="py">title</span> <span class="o">===</span> <span class="n">title</span><span class="o">).</span><span class="py">result</span><span class="o">.</span><span class="py">headOption</span>
  <span class="n">row</span>       <span class="k">=</span> <span class="nv">existing</span><span class="o">.</span><span class="py">map</span><span class="o">(</span><span class="nv">_</span><span class="o">.</span><span class="py">copy</span><span class="o">(</span><span class="n">rating</span><span class="k">=</span><span class="n">rating</span><span class="o">))</span> <span class="n">getOrElse</span> <span class="nc">Review</span><span class="o">(</span><span class="n">title</span><span class="o">,</span> <span class="n">rating</span><span class="o">)</span>
  <span class="n">result</span>   <span class="k">&lt;-</span> <span class="nv">reviews</span><span class="o">.</span><span class="py">insertOrUpdate</span><span class="o">(</span><span class="n">row</span><span class="o">)</span>
<span class="o">}</span> <span class="k">yield</span> <span class="n">result</span>
</code></pre></div></div>

<p>We’re now fetching a row and modifying it, or creating a new one and persisting it.  It’s the same pattern we’ve seen, combining <code class="language-plaintext highlighter-rouge">DBIO</code>s:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">result.headOption</code> is a <code class="language-plaintext highlighter-rouge">DBIO[Option[Review]]</code></li>
  <li>we use the <code class="language-plaintext highlighter-rouge">Option</code> like any other option, using <code class="language-plaintext highlighter-rouge">getOrElse</code> provide a default of a new row</li>
  <li>we upsert the row, giving a final result: a <code class="language-plaintext highlighter-rouge">DBIO[Int]</code>.</li>
</ul>

<h2 id="conclusions">Conclusions</h2>

<p>Slick contains a convenient way to upsert database records, based on the availability of a primary key.</p>

<p>But it is not limited to just that.  You can combine <em>database actions</em> together, mixing in your own custom logic.</p>

<p>There’s a <a href="https://github.com/d6y/slick-upsert">Github project</a> where you can try the code out.  This example is likely to appear in the upcoming revisions to <a href="http://underscore.io/training/courses/essential-slick/">Essential Slick</a>.</p>

        </article>

        <hr>

        
          <div class="row">
  <div class="col-sm-4 col-sm-offset-2">
    <h3 class="text-center">
      Like what you're reading?
    </h3>
    <p class="text-center">
      <a href="/blog/newsletters" class="btn btn-primary">
        Join our newsletter
        <span class="icon-uio-chevron-right "></span>
      </a>
    </p>
  </div>
</div>
        

        <hr>

        <h2 class="comments">Comments</h2>

<p>
  We encourage discussion of our blog posts on our <a href="https://gitter.im/underscoreio/scala">Gitter channel</a>.
  Please review our <a href="/terms#comments">Community Guidelines</a> before posting there.
  We encourage discussion in good faith, but do not allow combative, exclusionary, or harassing behaviour. 
  If you have any questions, <a href="/contact">contact us</a>!
</p>

      </section>
    </div>

    <div class="col-md-4">
      <aside class="blog-sidebar">
        <div id="mc_embed_signup" class="blog-sidebar-mailchimp panel panel-gray">
  <div class="panel-body">
    <h4>The Underscore Newsletter</h4>

    <p>Keep up to date! Subscribe to our newsletter for the latest Scala news.</p>

    <form method="post"
          action="http://underscoreconsulting.us3.list-manage.com/subscribe/post?u=a62dbb8a9c32f6c994dfd1111&amp;id=e9817b5369"
              id="mc-embedded-subscribe-form"
            name="mc-embedded-subscribe-form"
           class="validate"
          target="_blank"
      novalidate="">
      <fieldset>
        <div class="row">
          <div class="col-sm-12">
            <div class="form-group">
              <button class="btn btn-primary" id="mc-embedded-subscribe" type="submit" data-goal="click">Keep me posted</button>
            </div>
          </div>
        </div>
      </fieldset>
    </form>

    <p class="text-muted">
      <small>No spam. Unsubscribe at any time. We do not share personal details with third parties.</small>
    </p>

    <p class="text-muted">
      <small><a href="/blog/newsletters">Browse old newsletters to see what you'll get</a></small>
    </p>
  </div>
</div>
<div class="blog-sidebar-promos">
  <h4>Books from Underscore</h4>

  
  <div class="blog-sidebar-promo essential-scala"
     data-book-id="/books/essential-scala">
  <a class="book-title" href="/books/essential-scala">
    <span class="book-icon icon-uio-scala"></span>
    <span class="book-title-text">
      Essential Scala
    </span>

    <span class="pull-right">
      <span class="hidden-md">Read more</span>
      <span class="icon-uio-chevron-right "></span>
    </span>
  </a>
</div>


  
  <div class="blog-sidebar-promo scala-with-cats"
     data-book-id="/books/scala-with-cats">
  <a class="book-title" href="/books/scala-with-cats">
    <span class="book-icon icon-uio-cats"></span>
    <span class="book-title-text">
      Scala with Cats
    </span>

    <span class="pull-right">
      <span class="hidden-md">Read more</span>
      <span class="icon-uio-chevron-right "></span>
    </span>
  </a>
</div>


  
  <div class="blog-sidebar-promo essential-slick"
     data-book-id="/books/essential-slick">
  <a class="book-title" href="/books/essential-slick">
    <span class="book-icon icon-uio-scala"></span>
    <span class="book-title-text">
      Essential Slick
    </span>

    <span class="pull-right">
      <span class="hidden-md">Read more</span>
      <span class="icon-uio-chevron-right "></span>
    </span>
  </a>
</div>


  
  <div class="blog-sidebar-promo shapeless-guide"
     data-book-id="/books/shapeless-guide">
  <a class="book-title" href="/books/shapeless-guide">
    <span class="book-icon icon-uio-shapeless"></span>
    <span class="book-title-text">
      The Type Astronaut's Guide to Shapeless
    </span>

    <span class="pull-right">
      <span class="hidden-md">Read more</span>
      <span class="icon-uio-chevron-right "></span>
    </span>
  </a>
</div>

</div>

<aside class="blog-sidebar-archives">
  <h4>Archives</h4>

  <ul class="list-unstyled">
    
      
        <li class="heading">May 2020</li>
      

      <li><a href="/blog/posts/2020/05/27/scala-with-cats-2.html">Scala with Cats 2</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2020/05/14/porting-and-seq.html">Review Seq matching when porting to 2.13</a></li>
    
      
        
        
        
          <li class="heading">Dec 2019</li>
        
      

      <li><a href="/blog/posts/2019/12/23/talks-roundup.html">Our Talks from 2019</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2019/12/12/tut-to-mdoc.html">Tips for moving from tut to mdoc</a></li>
    
      
        
        
        
          <li class="heading">Jul 2019</li>
        
      

      <li><a href="/blog/posts/2019/07/04/introducing-inner-product.html">Introducing Inner Product</a></li>
    
      
        
        
        
          <li class="heading">Dec 2018</li>
        
      

      <li><a href="/blog/posts/2018/12/21/talks-roundup.html">Our Talks from 2018</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2018/12/12/bridges.html">Bridging Scala and the Front-End</a></li>
    
      
        
        
        
          <li class="heading">May 2018</li>
        
      

      <li><a href="/blog/posts/2018/05/17/modelling-js.html">Modelling JavaScript in Scala with Scala.js</a></li>
    
      
        
        
        
          <li class="heading">Mar 2018</li>
        
      

      <li><a href="/blog/posts/2018/03/20/fs2.html">Tips for working with FS2</a></li>
    
      
        
        
        
          <li class="heading">Dec 2017</li>
        
      

      <li><a href="/blog/posts/2017/12/14/scorex.html">A look at Scorex: a Scala blockchain framework</a></li>
    
      
        
        
        
          <li class="heading">Nov 2017</li>
        
      

      <li><a href="/blog/posts/2017/11/22/scala-with-cats.html">Announcing Scala with Cats</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2017/11/20/newsletter17.html">Newsletter 17: Season for Giving Edition</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2017/11/20/talks-from-team-underscore-at-scalax.html">Talks from Team Underscore at Scala Exchange</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2017/11/15/talks-to-watch-out-for-at-scalax.html">Talks to Watch Out For at Scala Exchange</a></li>
    
      
        
        
        
          <li class="heading">Sep 2017</li>
        
      

      <li><a href="/blog/posts/2017/09/05/review.html">Getting Into Other People's Code</a></li>
    
      
        
        
        
          <li class="heading">Jun 2017</li>
        
      

      <li><a href="/blog/posts/2017/06/02/uniting-church-and-state.html">Uniting Church and State: FP and OO Together</a></li>
    
      
        
        
        
          <li class="heading">May 2017</li>
        
      

      <li><a href="/blog/posts/2017/05/31/newsletter16.html">Newsletter 16: It's Book Time!</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2017/05/29/why-we-open-sourced-our-books.html">Why We Open Sourced our Books</a></li>
    
      
        
        
        
          <li class="heading">Apr 2017</li>
        
      

      <li><a href="/blog/posts/2017/04/11/type-tetris.html">Playing "Type Tetris"
</a></li>
    
      
        
        
        
          <li class="heading">Mar 2017</li>
        
      

      <li><a href="/blog/posts/2017/03/29/free-inject.html">The Free Monad with Multiple Algebras</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2017/03/07/refined-data-config-database.html">Refining your data from configuration to database</a></li>
    
      
        
        
        
          <li class="heading">Jan 2017</li>
        
      

      <li><a href="/blog/posts/2017/01/24/finch-functional-web-development.html">Finch: Functional Web Development</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2017/01/17/newsletter15.html">Newsletter 15: New Events in the New Year</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2017/01/17/agile-awards.html">Barclays Agile Awards 2016</a></li>
    
      
        
        
        
          <li class="heading">Dec 2016</li>
        
      

      <li><a href="/blog/posts/2016/12/16/newsletter14.html">Newsletter 14: Closing the Book on 2016</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2016/12/05/type-lambdas.html">Type lambdas and kind projector</a></li>
    
      
        
        
        
          <li class="heading">Nov 2016</li>
        
      

      <li><a href="/blog/posts/2016/11/24/value-discard.html">Value Discarding</a></li>
    
      
        
        
        
          <li class="heading">Oct 2016</li>
        
      

      <li><a href="/blog/posts/2016/10/11/twenty-two.html">Scala and 22</a></li>
    
      
        
        
        
          <li class="heading">Jul 2016</li>
        
      

      <li><a href="/blog/posts/2016/07/20/speaking-at-scalax.html">Giving a First Talk</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2016/07/20/new-speakers-at-scala-exchange-2016.html">How You Can Help Bring New Speakers and New Ideas to Scala eXchange 2016</a></li>
    
      
        
        
        
          <li class="heading">Jun 2016</li>
        
      

      <li><a href="/blog/posts/2016/06/27/opaque-transparent-interpreters.html">Opaque and Transparent Interpreters</a></li>
    
      
        
        
        
          <li class="heading">Apr 2016</li>
        
      

      <li><a href="/blog/posts/2016/04/21/probabilistic-programming.html">Probabilistic Programming in Scala</a></li>
    
      
        
        
        
          <li class="heading">Mar 2016</li>
        
      

      <li><a href="/blog/posts/2016/03/21/serverless-scale-summit.html">Scala.js is Important for Cloud Services</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2016/03/08/qcon.html">Types Working For You, Not Against You</a></li>
    
      
        
        
        
          <li class="heading">Feb 2016</li>
        
      

      <li><a href="/blog/posts/2016/02/02/advanced-scala-scalaz-to-cats.html">Advanced Scala Scalaz to Cats</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2016/02/01/aws-lambda.html">Scala and AWS Lambda Blueprints</a></li>
    
      
        
        
        
          <li class="heading">Jan 2016</li>
        
      

      <li><a href="/blog/posts/2016/01/19/typelevel-summits.html">Typelevel Summits</a></li>
    
      
        
        
        
          <li class="heading">Dec 2015</li>
        
      

      <li><a href="/blog/posts/2015/12/22/newsletter13.html">Newsletter 13: Christmas Loot Edition</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/12/21/scalax-slick-workshop.html">Video from the Slick Workshop at Scala Exchange 2015</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/12/21/scalax-interpreters-workshop.html">Slides and Code from the Interpreters Workshop at Scala Exchange 2015</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/12/18/tut.html">tut</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/12/18/scala-exchange-highlights.html">Highlights from Scala Exchange 2015</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/12/01/newsletter12.html">Newsletter 12: Scala Exchange</a></li>
    
      
        
        
        
          <li class="heading">Nov 2015</li>
        
      

      <li><a href="/blog/posts/2015/11/19/essential-slick-review-copies.html">Essential Slick Feature Complete and Review Copies Available</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/11/17/why-3x5-is-and-isnt-5x3.html">Why 3&times;5 is and isn't 5&times;3</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/11/09/sbt-commands.html">SBT Tricks</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/11/04/late-binding-and-overloading.html">Late Binding and Overloading in Scala</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/11/03/atom.html">Using the Atom Editor with Scala</a></li>
    
      
        
        
        
          <li class="heading">Oct 2015</li>
        
      

      <li><a href="/blog/posts/2015/10/14/reification.html">Reification, Kleislis, and Stream Libraries</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/10/01/newsletter11.html">Newsletter 11: Books and Boxes</a></li>
    
      
        
        
        
          <li class="heading">Sep 2015</li>
        
      

      <li><a href="/blog/posts/2015/09/16/book-update.html">Updates on the Underscore Books</a></li>
    
      
        
        
        
          <li class="heading">Aug 2015</li>
        
      

      <li><a href="/blog/posts/2015/08/28/essential-slick.html">Essential Slick Updates</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/08/23/slick-getresults.html">Using slickless with Plain SQL</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/08/08/slickless.html">Using shapeless HLists with Slick 3</a></li>
    
      
        
        
        
          <li class="heading">Jul 2015</li>
        
      

      <li><a href="/blog/posts/2015/07/24/diversity.html">You Can Increase Diversity at Scala eXchange</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/07/21/simple-isnt-easy.html">Simple Isn't Easy</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/07/14/upsert.html">Upsert in Slick 3</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/07/03/newsletter10.html">Newsletter 10: Conferences, Cats, and Robots from the Future</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/07/02/annihilators-in-scala.html">Annihilators in Scala: An Example of Type Class Design</a></li>
    
      
        
        
        
          <li class="heading">Jun 2015</li>
        
      

      <li><a href="/blog/posts/2015/06/25/keeping-scala-simple.html">Keeping Scala Simple</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/06/10/scalajs-scaladays.html">Towards Browser and Server Utopia with Scala.js</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/06/10/an-introduction-to-cats.html">An Introduction to Cats</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/06/05/new-speakers-at-scala-exchange-2015.html">New Speakers at Scala Exchange 2015</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/06/04/newsletter9.html">Newsletter 9: Scala Jobs, Slick, Sealed Traits, Strata, and Scala Days</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/06/04/more-on-sealed.html">More on Sealed Traits in Scala</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/06/02/everything-about-sealed.html">Everything You Ever Wanted to Know About Sealed Traits in Scala</a></li>
    
      
        
        
        
          <li class="heading">May 2015</li>
        
      

      <li><a href="/blog/posts/2015/05/28/typechecking-sql.html">Typechecking SQL in Slick and doobie</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/05/15/slick-enrichment.html">Slick Query Enrichment</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/05/14/strata-hadoop-world.html">Strata + Hadoop World London 2015 In Review</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/05/06/essential-slick.html">Introducing Essential Slick</a></li>
    
      
        
        
        
          <li class="heading">Apr 2015</li>
        
      

      <li><a href="/blog/posts/2015/04/30/newsletter8.html">Newsletter 8: Free Monads and Free Courses</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/04/28/monadic-io-laziness-makes-you-free.html">Monadic IO: Laziness Makes You Free</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/04/24/distributed-teams.html">Practices for Distributed Scala Teams</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/04/23/deriving-the-free-monad.html">Deriving the Free Monad</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/04/14/free-monads-are-simple.html">Free Monads Are Simple</a></li>
    
      
        
        
        
          <li class="heading">Mar 2015</li>
        
      

      <li><a href="/blog/posts/2015/03/13/rxlift.html">RxLift: Reactive Web Components with LiftWeb and RxScala</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/03/05/newsletter7.html">Newsletter 7: Error Handling and Two New Books</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/03/05/compositional-music-composition.html">Compositional Music Composition</a></li>
    
      
        
        
        
          <li class="heading">Feb 2015</li>
        
      

      <li><a href="/blog/posts/2015/02/25/creative-scala-released.html">Creative Scala: A New Introduction to Scala</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/02/23/designing-fail-fast-error-handling.html">Designing Fail-Fast Error Handling</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/02/13/error-handling-without-throwing-your-hands-up.html">Error Handling Without Throwing Your Hands Up</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/02/09/newsletter6.html">Newsletter 6: Training and Diversity Online and Worldwide</a></li>
    
      
        
        
        
          <li class="heading">Jan 2015</li>
        
      

      <li><a href="/blog/posts/2015/01/29/rethinking-online-training.html">Rethinking Online Training</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/01/29/diversity-in-training.html">Diversity in Training</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/01/16/lift-26-release.html">Highlights of the Lift Web Framework 2.6 Release</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/01/14/new-speakers-at-scala-exchange.html">Roundup of the New Speakers at Scala Exchange</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2015/01/05/codereview.html">Code Review at Scala eXchange</a></li>
    
      
        
        
        
          <li class="heading">Dec 2014</li>
        
      

      <li><a href="/blog/posts/2014/12/16/essential-scala-and-play-books-available-for-early-access.html">Essential Scala and Play Books Available for Early Access</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/12/05/newsletter5.html">Newsletter 5: Xmas Reading</a></li>
    
      
        
        
        
          <li class="heading">Oct 2014</li>
        
      

      <li><a href="/blog/posts/2014/10/20/newsletter4.html">Newsletter 4</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/10/20/essential-esential-scala-at-hack-the-tower.html">Essential Essential Scala at Hack the Tower</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/10/17/new-speakers-at-scala-exchange.html">New Speakers at Scala Exchange</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/10/02/learn-shapeless-find-500-dollars.html">Learn Shapeless, Find $500</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/10/01/intro-functional-finance.html">Introducing Functional Finance</a></li>
    
      
        
        
        
          <li class="heading">Sep 2014</li>
        
      

      <li><a href="/blog/posts/2014/09/16/response-to-the-typelevel-fork.html">Our Response to the Typelevel fork of Scala</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/09/03/enumerations.html">Scala Enumerations</a></li>
    
      
        
        
        
          <li class="heading">Aug 2014</li>
        
      

      <li><a href="/blog/posts/2014/08/28/tools-to-guide-code-quality.html">Tools to guide code quality</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/08/17/angularjs-vs-react.html">AngularJs vs React</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/08/07/newsletter3.html">Newsletter 3</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/08/07/scala-exchange-nsap-last-call.html">Scala Exchange New Speaker Programme Closing Soon</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/08/05/code-reviews-dont-produce-quality-code.html">Code Reviews Don't Produce Quality Code</a></li>
    
      
        
        
        
          <li class="heading">Jul 2014</li>
        
      

      <li><a href="/blog/posts/2014/07/27/readerwriterstate.html">A Small (Real) Example of the Reader and Writer Monads</a></li>
    
      
        
        
        
          <li class="heading">Jun 2014</li>
        
      

      <li><a href="/blog/posts/2014/06/30/underscores-new-speaker-program.html">Underscore's New Speaker Program for Scala Exchange</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/06/24/scala-days-2014-the-lowdown.html">Scala Days 2014: The Low-down</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/06/21/announcing-underscoreio.html">Announcing underscore.io</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/06/05/lambda.html">Java 8 Crib Sheet for Scala Developers</a></li>
    
      
        
        
        
          <li class="heading">May 2014</li>
        
      

      <li><a href="/blog/posts/2014/05/02/hiring-scala-developers.html">Hiring Scala Developers</a></li>
    
      
        
        
        
          <li class="heading">Apr 2014</li>
        
      

      <li><a href="/blog/posts/2014/04/30/newsletter2.html">Newsletter 2</a></li>
    
      
        
        
        
          <li class="heading">Mar 2014</li>
        
      

      <li><a href="/blog/posts/2014/03/18/newsletter1.html">Newsletter 1</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/03/10/teaching-scala.html">Teaching Scala</a></li>
    
      
        
        
        
          <li class="heading">Jan 2014</li>
        
      

      <li><a href="/blog/posts/2014/01/29/unboxed-tagged-angst.html">Unboxed Tagged Angst</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2014/01/06/crdt.html">Collaborative Text Editing</a></li>
    
      
        
        
        
          <li class="heading">Dec 2013</li>
        
      

      <li><a href="/blog/posts/2013/12/20/scalaz-monad-transformers.html">Scalaz Monad Transformers</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2013/12/20/crdts-for-fun-and-eventual-profit.html">CRDTs for fun and eventual profit</a></li>
    
      
        
        
        
          <li class="heading">Oct 2013</li>
        
      

      <li><a href="/blog/posts/2013/10/01/functional-media-roundup-quality-counts.html">Functional Media Roundup: Quality Counts</a></li>
    
      
        
        
        
          <li class="heading">Aug 2013</li>
        
      

      <li><a href="/blog/posts/2013/08/01/lift.html">Lift Cookbook</a></li>
    
      
        
        
        
          <li class="heading">Jul 2013</li>
        
      

      <li><a href="/blog/posts/2013/07/09/media-panel.html">Functional Programming in Media and Publishing</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2013/07/03/cloudbees.html">CloudBees Service Partner</a></li>
    
      
        
        
        
          <li class="heading">Mar 2013</li>
        
      

      <li><a href="/blog/posts/2013/03/13/streaming-algorithms-preregister.html">Pre-register for Streaming Algorithms Course</a></li>
    
      
        
        
        
          <li class="heading">Oct 2012</li>
        
      

      <li><a href="/blog/posts/2012/10/16/a-tribute-to-phil-bagwell.html">A Tribute to Phil Bagwell</a></li>
    
      
        
        
        
          <li class="heading">Aug 2012</li>
        
      

      <li><a href="/blog/posts/2012/08/01/developer-price.html">Misconceptions about Scala Developer Rates</a></li>
    
      
        
        
        
          <li class="heading">Jul 2012</li>
        
      

      <li><a href="/blog/posts/2012/07/09/another-typeclass.html">Another Small Example of the Type Class Pattern</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2012/07/06/icml-review.html">Review of COLT and ICML</a></li>
    
      
        
        
        
      

      <li><a href="/blog/posts/2012/07/02/kleisli-arrows.html">A Small Example of Kleisli Arrows</a></li>
    
      
        
        
        
          <li class="heading">Jun 2012</li>
        
      

      <li><a href="/blog/posts/2012/06/16/phantom-types.html">A Small Example of Phantom Types</a></li>
    
      
        
        
        
          <li class="heading">May 2012</li>
        
      

      <li><a href="/blog/posts/2012/05/03/typeclasses.html">A Small Example of the Typeclass Pattern</a></li>
    
  </ul>
</aside>

      </aside>
    </div>
  </div>
</section>

<footer>
  <div class="container">
    <div class="text-center">
      <img src="/images/common/footer-brand.png" class="footer-brand" alt="Underscore">
    </div>

    <div class="row sitemap">
      <div class="col-sm-6 col-md-4">
        <h5><a href="/">Underscore</a></h5>
        <ul class="list-unstyled">
          <li><a href="/">Home</a></li>
          <li><a href="/consulting">Our Services</a></li>
          <li><a href="/privacy">Privacy Policy</a></li>
          <li class="currency-select">
            Currency:
            <a href="javascript:void(0)" class="currency-select-usd">USD</a>,
            <a href="javascript:void(0)" class="currency-select-gbp">GBP</a>,
            <a href="javascript:void(0)" class="currency-select-eur">EUR</a>
          </li>
        </ul>
      </div>

      <div class="col-sm-6 col-md-4">
        <h5><a href="/training">Courses and Training</a></h5>
        <ul class="list-unstyled">
          <li><a href="/training/bookings">Book a Course</a></li>
          <li><a href="/training">Course Directory</a></li>
          <li><a href="/training/courses/essential-scala">Essential Scala</a></li>
          <li><a href="/training/courses/advanced-scala">Advanced Scala with Cats</a></li>
        </ul>
      </div>

      <div class="col-sm-6 col-md-4">
        <h5><a href="/contact">Contact</a></h5>
        <ul class="list-unstyled">
          <li><a href="/contact">
            <span class="icon-uio-envelope "></span>
            hello@underscore.io
          </a></li>
          <li><a href="http://twitter.com/underscoreio">
            <span class="icon-uio-twitter "></span>
            @underscoreio
          </a></li>
          <li><a href="/blog/newsletters">
            <span class="icon-uio-public "></span>
            The Underscore Newsletter
          </a></li>
        </ul>
      </div>
    </div>

    <p class="copyright text-center">
      Copyright 2011&ndash;22.
      <br class="visible-xs">
      All rights reserved. <a href="/terms">Terms of use</a>
    </p>
  </div>
</footer>



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-29444727-2', 'underscore.io');
      ga('send', 'pageview');
    </script>
  </body>
</html>
